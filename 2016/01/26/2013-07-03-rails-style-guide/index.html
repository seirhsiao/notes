<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Rails 风格指南 | ——╅ 萧 ☯ ℡&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="序幕
Role models are important. – 机械战警 Alex J. Murphy

这份指南目的于演示一整套 Rails 3 开发的风格惯例及最佳实践。这是一份与由现存社群所驱动的Ruby 编码风格指南互补的指南。
而本指南中测试 Rails 应用小节摆在开发 Rails 应用之后，因为我相信行为驱动开发(BDD) 是最佳的软体开发之道。铭记在心吧。
Rails 是一个坚持己">
<meta property="og:type" content="article">
<meta property="og:title" content="Rails 风格指南">
<meta property="og:url" content="http://notes.seirhsiao.com/2016/01/26/2013-07-03-rails-style-guide/index.html">
<meta property="og:site_name" content="——╅ 萧 ☯ ℡'s Blog">
<meta property="og:description" content="序幕
Role models are important. – 机械战警 Alex J. Murphy

这份指南目的于演示一整套 Rails 3 开发的风格惯例及最佳实践。这是一份与由现存社群所驱动的Ruby 编码风格指南互补的指南。
而本指南中测试 Rails 应用小节摆在开发 Rails 应用之后，因为我相信行为驱动开发(BDD) 是最佳的软体开发之道。铭记在心吧。
Rails 是一个坚持己">
<meta property="og:image" content="http://i.creativecommons.org/l/by/3.0/88x31.png">
<meta property="og:updated_time" content="2016-01-26T12:38:15.272Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rails 风格指南">
<meta name="twitter:description" content="序幕
Role models are important. – 机械战警 Alex J. Murphy

这份指南目的于演示一整套 Rails 3 开发的风格惯例及最佳实践。这是一份与由现存社群所驱动的Ruby 编码风格指南互补的指南。
而本指南中测试 Rails 应用小节摆在开发 Rails 应用之后，因为我相信行为驱动开发(BDD) 是最佳的软体开发之道。铭记在心吧。
Rails 是一个坚持己">
  
    <link rel="alternative" href="/atom.xml" title="——╅ 萧 ☯ ℡&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">萧</a></h1>
		</hgroup>

		
		<p class="header-subtitle">闻道有先后，术业有专攻！</p>
		
		
		<form><input type="text" class="search" placeholder=" Search..."></form>
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">所有文章</a></li>
				        
							<li><a href="/tags/">标签云</a></li>
				        
							<li><a href="/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:309183912@qq.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="//github.com/seirhsiao" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
								<li id="知乎"><a class="知乎" target="_blank" href="http://www.zhihu.com/people/seirhsiao" title="知乎"></a></li>
					        
								<li id="豆瓣"><a class="豆瓣" target="_blank" href="http://www.douban.com/people/seirhsiao/" title="豆瓣"></a></li>
					        
								<li id="Google"><a class="Google" target="_blank" href="https://plus.google.com/107500783667317902716" title="Google"></a></li>
					        
								<li id="QQ"><a class="QQ" target="_blank" href="tencent://message/?uin=309183912&Site=www.seirhsiao.github.io/" title="QQ"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/EndNote/" style="font-size: 10px;">EndNote</a> <a href="/tags/GitCafe/" style="font-size: 10px;">GitCafe</a> <a href="/tags/GitHub/" style="font-size: 10px;">GitHub</a> <a href="/tags/Hexo/" style="font-size: 11.43px;">Hexo</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Reference/" style="font-size: 10px;">Reference</a> <a href="/tags/UML/" style="font-size: 11.43px;">UML</a> <a href="/tags/awk/" style="font-size: 11.43px;">awk</a> <a href="/tags/binding/" style="font-size: 10px;">binding</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/book/" style="font-size: 12.86px;">book</a> <a href="/tags/clojure/" style="font-size: 20px;">clojure</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/eclipse/" style="font-size: 12.86px;">eclipse</a> <a href="/tags/editor/" style="font-size: 10px;">editor</a> <a href="/tags/frontend/" style="font-size: 10px;">frontend</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/gitcafe/" style="font-size: 10px;">gitcafe</a> <a href="/tags/github/" style="font-size: 11.43px;">github</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/httpkit/" style="font-size: 10px;">httpkit</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/leigingen/" style="font-size: 10px;">leigingen</a> <a href="/tags/linux/" style="font-size: 14.29px;">linux</a> <a href="/tags/list/" style="font-size: 10px;">list</a> <a href="/tags/macro/" style="font-size: 10px;">macro</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/markdown/" style="font-size: 12.86px;">markdown</a> <a href="/tags/maven/" style="font-size: 12.86px;">maven</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nexus/" style="font-size: 11.43px;">nexus</a> <a href="/tags/rails/" style="font-size: 10px;">rails</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/ruby/" style="font-size: 11.43px;">ruby</a> <a href="/tags/seq/" style="font-size: 10px;">seq</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/tips/" style="font-size: 11.43px;">tips</a> <a href="/tags/tools/" style="font-size: 11.43px;">tools</a> <a href="/tags/vi/" style="font-size: 10px;">vi</a> <a href="/tags/书籍/" style="font-size: 11.43px;">书籍</a> <a href="/tags/优化/" style="font-size: 11.43px;">优化</a> <a href="/tags/入门/" style="font-size: 18.57px;">入门</a> <a href="/tags/技巧/" style="font-size: 10px;">技巧</a> <a href="/tags/指南/" style="font-size: 17.14px;">指南</a> <a href="/tags/环境搭建/" style="font-size: 12.86px;">环境搭建</a> <a href="/tags/类图/" style="font-size: 11.43px;">类图</a> <a href="/tags/翻译/" style="font-size: 15.71px;">翻译</a> <a href="/tags/语法/" style="font-size: 10px;">语法</a> <a href="/tags/资源/" style="font-size: 17.14px;">资源</a> <a href="/tags/集合/" style="font-size: 14.29px;">集合</a> <a href="/tags/风格/" style="font-size: 14.29px;">风格</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">一花一世界，一叶一追寻。一曲一场叹，一生为一人。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">萧</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">萧</a></h1>
			</hgroup>
			
			<p class="header-subtitle">闻道有先后，术业有专攻！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">所有文章</a></li>
		        
					<li><a href="/tags/">标签云</a></li>
		        
					<li><a href="/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:309183912@qq.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="//github.com/seirhsiao" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
								<li id="知乎"><a class="知乎" target="_blank" href="http://www.zhihu.com/people/seirhsiao" title="知乎"></a></li>
					        
								<li id="豆瓣"><a class="豆瓣" target="_blank" href="http://www.douban.com/people/seirhsiao/" title="豆瓣"></a></li>
					        
								<li id="Google"><a class="Google" target="_blank" href="https://plus.google.com/107500783667317902716" title="Google"></a></li>
					        
								<li id="QQ"><a class="QQ" target="_blank" href="tencent://message/?uin=309183912&Site=www.seirhsiao.github.io/" title="QQ"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2013-07-03-rails-style-guide" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/26/2013-07-03-rails-style-guide/" class="article-date">
  	<time datetime="2016-01-26T12:38:15.272Z" itemprop="datePublished">2016-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Rails 风格指南
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Guide/">Guide</a>
	</div>


        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/指南/">指南</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/翻译/">翻译</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/风格/">风格</a></li></ul>
	</div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="u5E8F_u5E55"><a href="#u5E8F_u5E55" class="headerlink" title="序幕"></a>序幕</h1><blockquote>
<p>Role models are important. <br><br>– 机械战警 Alex J. Murphy</p>
</blockquote>
<p>这份指南目的于演示一整套 Rails 3 开发的风格惯例及最佳实践。这是一份与由现存社群所驱动的<a href="https://github.com/bbatsov/ruby-style-guide" target="_blank" rel="external">Ruby 编码风格指南</a>互补的指南。</p>
<p>而本指南中<a href="/#testing">测试 Rails 应用</a>小节摆在<a href="/#developing">开发 Rails 应用</a>之后，因为我相信<a href="http://en.wikipedia.org/wiki/Behavior_Driven_Development" target="_blank" rel="external">行为驱动开发</a><br>(BDD) 是最佳的软体开发之道。铭记在心吧。</p>
<p>Rails 是一个坚持己见的框架，而这也是一份坚持己见的指南。在我的心里，我坚信 <a href="https://www.relishapp.com/rspec" target="_blank" rel="external">RSpec</a> 优于 Test::Unit，<a href="http://sass-lang.com/" target="_blank" rel="external">Sass</a> 优于 CSS 以及<br><a href="http://haml-lang.com/" target="_blank" rel="external">Haml</a>，(<a href="http://slim-lang.com/" target="_blank" rel="external">Slim</a>) 优于 Erb。所以不要期望在这里找到 Test::Unit, CSS 及 Erb 的忠告。</p>
<p>某些忠告仅适用于 Rails 3.1+ 以上版本。</p>
<p>你可以使用 <a href="https://github.com/TechnoGate/transmuter" target="_blank" rel="external">Transmuter</a> 来产生本指南的一份 PDF 或 HTML 复本。</p>
<h1 id="u76EE_u5F55"><a href="#u76EE_u5F55" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="/#-rails-">开发 Rails 应用程序</a><ul>
<li><a href="/#-2">配置</a></li>
<li><a href="/#-3">路由</a></li>
<li><a href="/#-4">控制器</a></li>
<li><a href="/#-5">模型</a></li>
<li><a href="/#-6">迁移</a></li>
<li><a href="/#-7">视图</a></li>
<li><a href="/#-8">国际化</a></li>
<li><a href="/#assets">Assets</a></li>
<li><a href="/#mailers">Mailers</a></li>
<li><a href="/#bundler">Bundler</a></li>
<li><a href="/#-gems">无价的 Gems</a></li>
<li><a href="/#-gems-1">缺陷的 Gems</a></li>
<li><a href="/#-9">管理进程</a></li>
</ul>
</li>
<li><a href="/#-rails--1">测试 Rails 应用</a><ul>
<li><a href="/#cucumber">Cucumber</a></li>
<li><a href="/#rspec">RSpec</a></li>
</ul>
</li>
</ul>
<p>本指南被翻译成下列语言：</p>
<ul>
<li><a href="https://github.com/JuanitoFatas/rails-style-guide/blob/master/README.md" target="_blank" rel="external">英文原版</a></li>
<li><a href="https://github.com/JuanitoFatas/rails-style-guide/blob/master/README-zhTW.md" target="_blank" rel="external">繁體中文</a><a id="more"></a>
<h1 id="u5F00_u53D1_Rails__u5E94_u7528_u7A0B_u5E8F"><a href="#u5F00_u53D1_Rails__u5E94_u7528_u7A0B_u5E8F" class="headerlink" title="开发 Rails 应用程序"></a>开发 Rails 应用程序</h1></li>
</ul>
<h2 id="u914D_u7F6E"><a href="#u914D_u7F6E" class="headerlink" title="配置"></a>配置</h2><ul>
<li>把惯用的初始化代码放在 <code>config/initializers</code>。 在 initializers 内的代码于应用启动时执行。</li>
<li>每一个 gem 相关的初始化代码应当使用同样的名称，放在不同的文件里，如： <code>carrierwave.rb</code>, <code>active_admin.rb</code>, 等等。</li>
<li><p>相应调整配置开发、测试及生产环境（在 <code>config/environments/</code> 下对应的文件）</p>
<ul>
<li><p>添加需要预编译的额外静态资源文件（如果有的话）：</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/environments/production.rb</span></span><br><span class="line"><span class="comment"># 预编译额外的静态资源文件(application.js, application.css, 以及所有已经被加入的非 JS 或 CSS 的文件)</span></span><br><span class="line">config.assets.precompile += <span class="string">%w( rails_admin/rails_admin.css rails_admin/rails_admin.js )</span></span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
</li>
<li><p>将所有环境皆通用的配置档放在 <code>config/application.rb</code> 文件。</p>
</li>
<li>构建一个与生产环境(production enviroment)相似的，一个额外的 <code>staging</code> 环境。</li>
</ul>
<h2 id="u8DEF_u7531"><a href="#u8DEF_u7531" class="headerlink" title="路由"></a>路由</h2><ul>
<li><p>当你需要加入一个或多个动作至一个 RESTful 资源时（你真的需要吗？），使用 <code>member</code> and <code>collection</code> 路由。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">get <span class="string">'subscriptions/:id/unsubscribe'</span></span><br><span class="line">resources <span class="symbol">:subscriptions</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">resources <span class="symbol">:subscriptions</span> <span class="keyword">do</span></span><br><span class="line">  get <span class="string">'unsubscribe'</span>, <span class="symbol">on:</span> <span class="symbol">:member</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">get <span class="string">'photos/search'</span></span><br><span class="line">resources <span class="symbol">:photos</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">resources <span class="symbol">:photos</span> <span class="keyword">do</span></span><br><span class="line">  get <span class="string">'search'</span>, <span class="symbol">on:</span> <span class="symbol">:collection</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>若你需要定义多个 <code>member/collection</code> 路由时，使用替代的区块语法(block syntax)。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resources <span class="symbol">:subscriptions</span> <span class="keyword">do</span></span><br><span class="line">  member <span class="keyword">do</span></span><br><span class="line">    get <span class="string">'unsubscribe'</span></span><br><span class="line">    <span class="comment"># 更多路由</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">resources <span class="symbol">:photos</span> <span class="keyword">do</span></span><br><span class="line">  collection <span class="keyword">do</span></span><br><span class="line">    get <span class="string">'search'</span></span><br><span class="line">    <span class="comment"># 更多路由</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用嵌套路由(nested routes)来更佳地表达与 ActiveRecord 模型的关系。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_many <span class="symbol">:comments</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comments</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  belongs_to <span class="symbol">:post</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># routes.rb</span></span><br><span class="line">resources <span class="symbol">:posts</span> <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:comments</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用命名空间路由来群组相关的行为。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">namespace <span class="symbol">:admin</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># Directs /admin/products/* to Admin::ProductsController</span></span><br><span class="line">  <span class="comment"># (app/controllers/admin/products_controller.rb)</span></span><br><span class="line">  resources <span class="symbol">:products</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要在控制器里使用留给后人般的疯狂路由(legacy wild controller route)。这种路由会让每个控制器的动作透过 GET 请求存取。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非常差</span></span><br><span class="line">match <span class="string">':controller(/:action(/:id(.:format)))'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u63A7_u5236_u5668"><a href="#u63A7_u5236_u5668" class="headerlink" title="控制器"></a>控制器</h2><ul>
<li>让你的控制器保持苗条 ― 它们应该只替视图层取出数据且不包含任何业务逻辑（所有业务逻辑应当放在模型里）。</li>
<li>每个控制器的行动应当（理想上）只调用一个除了初始的 find 或 new 方法。</li>
<li>控制器与视图之间共享不超过两个实例变量(instance variable)。</li>
</ul>
<h2 id="u6A21_u578B"><a href="#u6A21_u578B" class="headerlink" title="模型"></a>模型</h2><ul>
<li>自由地引入不是 ActiveRecord 的类别吧。</li>
<li>替模型命名有意义（但简短）且不带缩写的名字。</li>
<li><p>如果你需要模型有著 ActiveRecord 行为的对象，比方说验证这一块，使用 <a href="https://github.com/cgriego/active_attr" target="_blank" rel="external">ActiveAttr</a> gem。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span></span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">ActiveAttr::Model</span></span><br><span class="line"></span><br><span class="line">  attribute <span class="symbol">:name</span></span><br><span class="line">  attribute <span class="symbol">:email</span></span><br><span class="line">  attribute <span class="symbol">:content</span></span><br><span class="line">  attribute <span class="symbol">:priority</span></span><br><span class="line"></span><br><span class="line">  attr_accessible <span class="symbol">:name</span>, <span class="symbol">:email</span>, <span class="symbol">:content</span></span><br><span class="line"></span><br><span class="line">  validates_presence_of <span class="symbol">:name</span></span><br><span class="line">  validates_format_of <span class="symbol">:email</span>, <span class="symbol">:with</span> =&gt; <span class="regexp">/\A[-a-z0-9_+\.]+\@([-a-z0-9]+\.)+[a-z0-9]&#123;2,4&#125;\z/i</span></span><br><span class="line">  validates_length_of <span class="symbol">:content</span>, <span class="symbol">:maximum</span> =&gt; <span class="number">500</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  更完整的示例，参考 <a href="http://railscasts.com/episodes/326-activeattr" target="_blank" rel="external">RailsCast on the subject</a>。</p>
</li>
</ul>
<h3 id="ActiveRecord"><a href="#ActiveRecord" class="headerlink" title="ActiveRecord"></a>ActiveRecord</h3><ul>
<li>避免改动缺省的 ActiveRecord（表的名字、主键，等等），除非你有一个非常好的理由（像是不受你控制的数据库）。</li>
<li><p>把宏风格的方法（<code>has_many</code>, <code>validates</code>, 等等）放在类别定义的前面。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="comment"># 默认的scope放在最前面(如果有)</span></span><br><span class="line">  default_scope &#123; where(<span class="symbol">active:</span> <span class="keyword">true</span>) &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 接下来是常量</span></span><br><span class="line">  <span class="constant">GENDERS</span> = <span class="string">%w(male female)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 然后放一些attr相关的宏</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:formatted_date_of_birth</span></span><br><span class="line"></span><br><span class="line">  attr_accessible <span class="symbol">:login</span>, <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>, <span class="symbol">:email</span>, <span class="symbol">:password</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 仅接着是关联的宏</span></span><br><span class="line">  belongs_to <span class="symbol">:country</span></span><br><span class="line"></span><br><span class="line">  has_many <span class="symbol">:authentications</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 以及宏的验证</span></span><br><span class="line">  validates <span class="symbol">:email</span>, <span class="symbol">presence:</span> <span class="keyword">true</span></span><br><span class="line">  validates <span class="symbol">:username</span>, <span class="symbol">presence:</span> <span class="keyword">true</span></span><br><span class="line">  validates <span class="symbol">:username</span>, <span class="symbol">uniqueness:</span> &#123; <span class="symbol">case_sensitive:</span> <span class="keyword">false</span> &#125;</span><br><span class="line">  validates <span class="symbol">:username</span>, <span class="symbol">format:</span> &#123; <span class="symbol">with:</span> /\<span class="constant">A</span>[<span class="constant">A</span>-<span class="constant">Za</span>-z][<span class="constant">A</span>-<span class="constant">Za</span>-z<span class="number">0</span>-<span class="number">9._</span>-]&#123;<span class="number">2</span>,<span class="number">19</span>&#125;\z/ &#125;</span><br><span class="line">  validates <span class="symbol">:password</span>, <span class="symbol">format:</span> &#123; <span class="symbol">with:</span> /\<span class="constant">A</span>\<span class="constant">S</span>&#123;<span class="number">8</span>,<span class="number">128</span>&#125;\z/, <span class="symbol">allow_nil:</span> <span class="keyword">true</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 接着是回调</span></span><br><span class="line">  before_save <span class="symbol">:cook</span></span><br><span class="line">  before_save <span class="symbol">:update_username_lower</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 其它的宏 (像devise的) 应该放在回调的后面</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>偏好 <code>has_many :through</code> 胜于 <code>has_and_belongs_to_many</code>。 使用 <code>has_many :through</code> 允许在 join 模型有附加的属性及验证</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 has_and_belongs_to_many</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_and_belongs_to_many <span class="symbol">:groups</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_and_belongs_to_many <span class="symbol">:users</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 偏好方式 - using has_many :through</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_many <span class="symbol">:memberships</span></span><br><span class="line">  has_many <span class="symbol">:groups</span>, <span class="symbol">through:</span> <span class="symbol">:memberships</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Membership</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  belongs_to <span class="symbol">:user</span></span><br><span class="line">  belongs_to <span class="symbol">:group</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  has_many <span class="symbol">:memberships</span></span><br><span class="line">  has_many <span class="symbol">:users</span>, <span class="symbol">through:</span> <span class="symbol">:memberships</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用新的 <a href="http://thelucid.com/2010/01/08/sexy-validation-in-edge-rails-rails-3/" target="_blank" rel="external">“sexy” validation</a>。</p>
</li>
<li><p>当一个惯用的验证使用超过一次或验证是某个正则表达映射时，创建一个惯用的 validator 文件。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  validates <span class="symbol">:email</span>, <span class="symbol">format:</span> &#123; <span class="symbol">with:</span> /\<span class="constant">A</span>([^@\s]+)@((?<span class="symbol">:</span>[-a-z<span class="number">0</span>-<span class="number">9</span>]+\.)+[a-z]&#123;<span class="number">2</span>,&#125;)\z/i &#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmailValidator</span> <span class="inheritance">&lt; <span class="parent">ActiveModel::EachValidator</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">validate_each</span><span class="params">(record, attribute, value)</span></span></span><br><span class="line">    record.errors[attribute] &lt;&lt; (options[<span class="symbol">:message</span>] || <span class="string">'is not a valid email'</span>) <span class="keyword">unless</span> value =~ <span class="regexp">/\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]&#123;2,&#125;)\z/i</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  validates <span class="symbol">:email</span>, <span class="symbol">email:</span> <span class="keyword">true</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>所有惯用的验证器应放在一个共享的 gem 。</p>
</li>
<li><p>自由地使用命名的作用域(scope)。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  scope <span class="symbol">:active</span>, -&gt; &#123; where(<span class="symbol">active:</span> <span class="keyword">true</span>) &#125;</span><br><span class="line">  scope <span class="symbol">:inactive</span>, -&gt; &#123; where(<span class="symbol">active:</span> <span class="keyword">false</span>) &#125;</span><br><span class="line"></span><br><span class="line">  scope <span class="symbol">:with_orders</span>, -&gt; &#123; joins(<span class="symbol">:orders</span>).select(<span class="string">'distinct(users.id)'</span>) &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将命名的作用域包在 <code>lambda</code> 里来惰性地初始化。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差劲</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  scope <span class="symbol">:active</span>, where(<span class="symbol">active:</span> <span class="keyword">true</span>)</span><br><span class="line">  scope <span class="symbol">:inactive</span>, where(<span class="symbol">active:</span> <span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line">  scope <span class="symbol">:with_orders</span>, joins(<span class="symbol">:orders</span>).select(<span class="string">'distinct(users.id)'</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  scope <span class="symbol">:active</span>, -&gt; &#123; where(<span class="symbol">active:</span> <span class="keyword">true</span>) &#125;</span><br><span class="line">  scope <span class="symbol">:inactive</span>, -&gt; &#123; where(<span class="symbol">active:</span> <span class="keyword">false</span>) &#125;</span><br><span class="line"></span><br><span class="line">  scope <span class="symbol">:with_orders</span>, -&gt; &#123; joins(<span class="symbol">:orders</span>).select(<span class="string">'distinct(users.id)'</span>) &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当一个由 lambda 及参数定义的作用域变得过于复杂时，更好的方式是建一个作为同样用途的类别方法，并返回一个 <code>ActiveRecord::Relation</code> 对象。你也可以这么定义出更精简的作用域。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">with_orders</span></span></span><br><span class="line">    joins(<span class="symbol">:orders</span>).select(<span class="string">'distinct(users.id)'</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注意 <code>update_attribute</code> 方法的行为。它不运行模型验证（不同于 <code>update_attributes</code> ）并且可能把模型状态给搞砸。</p>
</li>
<li><p>使用用户友好的网址。在网址显示具描述性的模型属性，而不只是 <code>id</code> 。<br>有不止一种方法可以达成：</p>
<ul>
<li><p>覆写模型的 <code>to_param</code> 方法。这是 Rails 用来给对象建构网址的方法。缺省的实作会以字串形式返回该 <code>id</code> 的记录。它可被另一个具人类可读的属性覆写。</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_param</span></span></span><br><span class="line">    <span class="string">"<span class="subst">#&#123;id&#125;</span> <span class="subst">#&#123;name&#125;</span>"</span>.parameterize</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</code></pre><p>为了要转换成对网址友好 (URL-friendly)的数值，字串应当调用 <code>parameterize</code> 。 对象的 <code>id</code> 要放在开头，以便给 ActiveRecord 的 <code>find</code> 方法查找。</p>
</li>
<li><p>使用此 <code>friendly_id</code> gem。它允许藉由某些具描述性的模型属性，而不是用 <code>id</code> 来创建人类可读的网址。</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  extend <span class="constant">FriendlyId</span></span><br><span class="line">  friendly_id <span class="symbol">:name</span>, <span class="symbol">use:</span> <span class="symbol">:slugged</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

查看 [gem 文档](https://github.com/norman/friendly_id)获得更多关于使用的信息。
</code></pre></li>
</ul>
</li>
</ul>
<h3 id="ActiveResource"><a href="#ActiveResource" class="headerlink" title="ActiveResource"></a>ActiveResource</h3><ul>
<li><p>当 HTTP 响应是一个与存在的格式不同的格式时（XML 和 JSON），需要某些额外的格式解析，创一个你惯用的格式，并在类别中使用它。惯用的格式应当实作下列方法：<code>extension</code>, <code>mime_type</code>,<br><code>encode</code> 以及 <code>decode</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">ActiveResource</span></span></span><br><span class="line">  <span class="class"><span class="keyword">module</span> <span class="title">Formats</span></span></span><br><span class="line">    <span class="class"><span class="keyword">module</span> <span class="title">Extend</span></span></span><br><span class="line">      <span class="class"><span class="keyword">module</span> <span class="title">CSVFormat</span></span></span><br><span class="line">        extend <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">extension</span></span></span><br><span class="line">          <span class="string">'csv'</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">mime_type</span></span></span><br><span class="line">          <span class="string">'text/csv'</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(hash, options = <span class="keyword">nil</span>)</span></span></span><br><span class="line">          <span class="comment"># 数据以新格式编码并返回</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(csv)</span></span></span><br><span class="line">          <span class="comment"># 数据以新格式解码并返回</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveResource::Base</span></span></span></span><br><span class="line">  <span class="keyword">self</span>.format = <span class="constant">ActiveResource::Formats::Extend::CSVFormat</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>若 HTTP 请求应当不扩展发送时，覆写 <code>ActiveResource::Base</code> 的 <code>element_path</code> 及 <code>collection_path</code> 方法，并移除扩展的部份。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="inheritance">&lt; <span class="parent">ActiveResource::Base</span></span></span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">collection_path</span><span class="params">(prefix_options = &#123;&#125;, query_options = <span class="keyword">nil</span>)</span></span></span><br><span class="line">    prefix_options, query_options = split_options(prefix_options) <span class="keyword">if</span> query_options.<span class="keyword">nil</span>?</span><br><span class="line">    <span class="string">"<span class="subst">#&#123;prefix(prefix_options)&#125;</span><span class="subst">#&#123;collection_name&#125;</span><span class="subst">#&#123;query_string(query_options)&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">element_path</span><span class="params">(id, prefix_options = &#123;&#125;, query_options = <span class="keyword">nil</span>)</span></span></span><br><span class="line">    prefix_options, query_options = split_options(prefix_options) <span class="keyword">if</span> query_options.<span class="keyword">nil</span>?</span><br><span class="line">    <span class="string">"<span class="subst">#&#123;prefix(prefix_options)&#125;</span><span class="subst">#&#123;collection_name&#125;</span>/<span class="subst">#&#123;<span class="constant">URI</span>.parser.escape id.to_s&#125;</span><span class="subst">#&#123;query_string(query_options)&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  如有任何改动网址的需求时，这些方法也可以被覆写。</p>
</li>
</ul>
<h2 id="u8FC1_u79FB"><a href="#u8FC1_u79FB" class="headerlink" title="迁移"></a>迁移</h2><ul>
<li>把 <code>schema.rb</code> 保存在版本管控之下。</li>
<li>使用 <code>rake db:scheme:load</code> 取代 <code>rake db:migrate</code> 来初始化空的数据库。</li>
<li>使用 <code>rake db:test:prepare</code> 来更新测试数据库的 schema。</li>
<li><p>避免在表里设置缺省数据。使用模型层来取代。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">amount</span></span></span><br><span class="line">  <span class="keyword">self</span>[<span class="symbol">:amount</span>] <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  然而 <code>self[:attr_name]</code> 的使用被视为相当常见的，你也可以考虑使用更罗嗦的（争议地可读性更高的） <code>read_attribute</code> 来取代：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">amount</span></span></span><br><span class="line">  read_attribute(<span class="symbol">:amount</span>) <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当编写建设性的迁移时（加入表或栏位），使用 Rails 3.1 的新方式来迁移 - 使用 <code>change</code> 方法取代 <code>up</code> 与 <code>down</code> 方法。</p>
</li>
</ul>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过去的方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddNameToPerson</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Migration</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">up</span></span></span><br><span class="line">    add_column <span class="symbol">:persons</span>, <span class="symbol">:name</span>, <span class="symbol">:string</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">down</span></span></span><br><span class="line">    remove_column <span class="symbol">:person</span>, <span class="symbol">:name</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新的偏好方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddNameToPerson</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Migration</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></span><br><span class="line">    add_column <span class="symbol">:persons</span>, <span class="symbol">:name</span>, <span class="symbol">:string</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</code></pre><h2 id="u89C6_u56FE"><a href="#u89C6_u56FE" class="headerlink" title="视图"></a>视图</h2><ul>
<li>不要直接从视图调用模型层。</li>
<li>不要在视图构造复杂的格式，把它们输出到视图 helper 的一个方法或是模型。</li>
<li>使用 partial 模版与布局来减少重复的代码。</li>
<li><p>加入 <a href="https://github.com/bcardarella/client_side_validations" target="_blank" rel="external">client side validation</a> 至惯用的 validators。 要做的步骤有：</p>
<ul>
<li><p>声明一个由 <code>ClientSideValidations::Middleware::Base</code> 而来的自定 validator</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">ClientSideValidations::Middleware</span></span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Email</span> <span class="inheritance">&lt; <span class="parent">Base</span></span></span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">response</span></span></span><br><span class="line">      <span class="keyword">if</span> request.params[<span class="symbol">:email</span>] =~ <span class="regexp">/\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]&#123;2,&#125;)\z/i</span></span><br><span class="line">        <span class="keyword">self</span>.status = <span class="number">200</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">self</span>.status = <span class="number">404</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">super</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</code></pre></li>
<li><p>建立一个新文件<br><code>public/javascripts/rails.validations.custom.js.coffee</code> 并在你的 <code>application.js.coffee</code> 文件加入一个它的参照：</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/assets/javascripts/application.js.coffee</span></span><br><span class="line"><span class="comment">#= require rails.validations.custom</span></span><br></pre></td></tr></table></figure>
</code></pre></li>
<li><p>添加你的用户端 validator：</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#public/javascripts/rails.validations.custom.js.coffee</span></span><br><span class="line">clientSideValidations.validators.remote[<span class="string">'email'</span>] = (element, options) -&gt;</span><br><span class="line">  <span class="keyword">if</span> <span class="variable">$.</span>ajax(&#123;</span><br><span class="line">    <span class="symbol">url:</span> <span class="string">'/validators/email.json'</span>,</span><br><span class="line">    <span class="symbol">data:</span> &#123; <span class="symbol">email:</span> element.val() &#125;,</span><br><span class="line">    <span class="symbol">async:</span> <span class="keyword">false</span></span><br><span class="line">  &#125;).status == <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> options.message || <span class="string">'invalid e-mail format'</span></span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
</li>
</ul>
<h2 id="u56FD_u9645_u5316"><a href="#u56FD_u9645_u5316" class="headerlink" title="国际化"></a>国际化</h2><ul>
<li>视图、模型与控制器里不应使用语言相关设置与字串。这些文字应搬到在 <code>config/locales</code> 下的语言文件里。</li>
<li><p>当 ActiveRecord 模型的标签需要被翻译时，使用<code>activerecord</code> 作用域:</p>
  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">en</span>:</span><br><span class="line">  <span class="attribute">activerecord</span>:</span><br><span class="line">    <span class="attribute">models</span>:</span><br><span class="line">      <span class="attribute">user</span>: Member</span><br><span class="line">    <span class="attribute">attributes</span>:</span><br><span class="line">      <span class="attribute">user</span>:</span><br><span class="line">        <span class="attribute">name</span>: <span class="string">"Full name"</span></span><br></pre></td></tr></table></figure>
<p>  然后 <code>User.model_name.human</code> 会返回 “Member” ，而 <code>User.human_attribute_name(&quot;name&quot;)</code> 会返回 “Full name”。这些属性的翻译会被视图作为标签使用。</p>
</li>
<li><p>把在视图使用的文字与 ActiveRecord 的属性翻译分开。 把给模型使用的语言文件放在名为 <code>models</code> 的文件夹，给视图使用的文字放在名为 <code>views</code> 的文件夹。</p>
<ul>
<li><p>当使用额外目录的语言文件组织完成时，为了要载入这些目录，要在 <code>application.rb</code> 文件里描述这些目录。</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/application.rb</span></span><br><span class="line">config.i18n.load_path += <span class="constant">Dir</span>[<span class="constant">Rails</span>.root.join(<span class="string">'config'</span>, <span class="string">'locales'</span>, <span class="string">'**'</span>, <span class="string">'*.&#123;rb,yml&#125;'</span>)]</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
</li>
<li><p>把共享的本土化选项，像是日期或货币格式，放在 <code>locales</code> 的根目录下。</p>
</li>
<li>使用精简形式的 I18n 方法： <code>I18n.t</code> 来取代 <code>I18n.translate</code> 以及使用 <code>I18n.l</code> 取代 <code>I18n.localize</code>。</li>
<li><p>使用 “懒惰” 查询视图中使用的文字。假设我们有以下结构：</p>
  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">en</span>:</span><br><span class="line">  <span class="attribute">users</span>:</span><br><span class="line">    <span class="attribute">show</span>:</span><br><span class="line">      <span class="attribute">title</span>: <span class="string">"User details page"</span></span><br></pre></td></tr></table></figure>
<p>  <code>users.show.title</code> 的数值能这样被 <code>app/views/users/show.html.haml</code> 查询：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">= t <span class="string">'.title'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在控制器与模型使用点分隔的键，来取代指定 <code>:scope</code> 选项。点分隔的调用更容易阅读及追踪层级。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这样子调用</span></span><br><span class="line"><span class="constant">I18n</span>.t <span class="string">'activerecord.errors.messages.record_invalid'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 而不是这样</span></span><br><span class="line"><span class="constant">I18n</span>.t <span class="symbol">:record_invalid</span>, <span class="symbol">:scope</span> =&gt; [<span class="symbol">:activerecord</span>, <span class="symbol">:errors</span>, <span class="symbol">:messages</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>关于 Rails i18n 更详细的信息可以在这里找到 <a href="http://guides.rubyonrails.org/i18n.html" target="_blank" rel="external">Rails Guides</a>。</p>
</li>
</ul>
<h2 id="Assets"><a href="#Assets" class="headerlink" title="Assets"></a>Assets</h2><p>利用这个 <a href="http://guides.rubyonrails.org/asset_pipeline.html" target="_blank" rel="external">assets pipeline</a> 来管理应用的结构。</p>
<ul>
<li>保留 <code>app/assets</code> 给自定的样式表，Javascripts 或图片。</li>
<li>把自己开发，但不适合用在这个应用的函式库，放在 <code>lib/assets/</code>。</li>
<li>第三方代码如： <a href="http://jquery.com/" target="_blank" rel="external">jQuery</a> 或 <a href="http://twitter.github.com/bootstrap/" target="_blank" rel="external">bootstrap</a> 应放置在 <code>vendor/assets</code>。</li>
<li>当可能的时候，使用 gem 化的 assets 版本。(如： <a href="https://github.com/rails/jquery-rails" target="_blank" rel="external">jquery-rails</a>)。</li>
</ul>
<h2 id="Mailers"><a href="#Mailers" class="headerlink" title="Mailers"></a>Mailers</h2><ul>
<li>把 mails 命名为 <code>SomethingMailer</code>。 没有 Mailer 字根的话，不能立即显现哪个是一个 Mailer，以及哪个视图与它有关。</li>
<li>提供 HTML 与纯文本视图模版。</li>
<li><p>在你的开发环境启用信件失败发送错误。这些错误缺省是被停用的。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/environments/development.rb</span></span><br><span class="line"></span><br><span class="line">config.action_mailer.raise_delivery_errors = <span class="keyword">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在开发模式使用 <code>smtp.gmail.com</code> 设置 SMTP 服务器（当然了，除非你自己有本地 SMTP 服务器）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/environments/development.rb</span></span><br><span class="line"></span><br><span class="line">config.action_mailer.smtp_settings = &#123;</span><br><span class="line">  <span class="symbol">address:</span> <span class="string">'smtp.gmail.com'</span>,</span><br><span class="line">  <span class="comment"># 更多设置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>提供缺省的配置给主机名。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/environments/development.rb</span></span><br><span class="line">config.action_mailer.default_url_options = &#123;<span class="symbol">host:</span> <span class="string">"<span class="subst">#&#123;local_ip&#125;</span>:3000"</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># config/environments/production.rb</span></span><br><span class="line">config.action_mailer.default_url_options = &#123;<span class="symbol">host:</span> <span class="string">'your_site.com'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在你的 mailer 类</span></span><br><span class="line">default_url_options[<span class="symbol">:host</span>] = <span class="string">'your_site.com'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你需要在你的网站使用一个 email 链结，总是使用 <code>_url</code> 方法，而不是 <code>_path</code> 方法。 <code>_url</code> 方法包含了主机名，而 <code>_path</code> 方法没有。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误</span></span><br><span class="line"><span class="constant">You</span> can always find more info about this course</span><br><span class="line">= link_to <span class="string">'here'</span>, url_for(course_path(<span class="variable">@course</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确</span></span><br><span class="line"><span class="constant">You</span> can always find more info about this course</span><br><span class="line">= link_to <span class="string">'here'</span>, url_for(course_url(<span class="variable">@course</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>正确地显示寄与收件人地址的格式。使用下列格式：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在你的 mailer 类别</span></span><br><span class="line">default <span class="symbol">from:</span> <span class="string">'Your Name &lt;info@your_site.com&gt;'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>确定测试环境的 email 发送方法设置为 <code>test</code> ：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/environments/test.rb</span></span><br><span class="line"></span><br><span class="line">config.action_mailer.delivery_method = <span class="symbol">:test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>开发与生产环境的发送方法应为 <code>smtp</code> ：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/environments/development.rb, config/environments/production.rb</span></span><br><span class="line"></span><br><span class="line">config.action_mailer.delivery_method = <span class="symbol">:smtp</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当发送 HTML email 时，所有样式应为行内样式，由于某些用户有关于外部样式的问题。某种程度上这使得更难管理及造成代码重用。有两个相似的 gem 可以转换样式，以及将它们放在对应的 html 标签里： <a href="https://github.com/fphilipe/premailer-rails3" target="_blank" rel="external">premailer-rails3</a> 和 <a href="https://github.com/Mange/roadie" target="_blank" rel="external">roadie</a>。</p>
</li>
<li><p>应避免页面产生响应时寄送 email。若多个 email 寄送时，造成了页面载入延迟，以及请求可能逾时。使用 <a href="https://github.com/tobi/delayed_job" target="_blank" rel="external">delayed_job</a> gem 的帮助来克服在背景处理寄送 email 的问题。</p>
</li>
</ul>
<h2 id="Bundler"><a href="#Bundler" class="headerlink" title="Bundler"></a>Bundler</h2><ul>
<li>把只给开发环境或测试环境的 gem 适当地分组放在 Gemfile 文件中。</li>
<li>在你的项目中只使用公认的 gem。 如果你考虑引入某些鲜为人所知的 gem ，你应该先仔细复查一下它的源代码。</li>
<li><p>关于多个开发者使用不同操作系统的项目，操作系统相关的 gem 缺省会产生一个经常变动的 <code>Gemfile.lock</code> 。 在 Gemfile 文件里，所有与 OS X 相关的 gem 放在 <code>darwin</code> 群组，而所有 Linux 相关的 gem 放在 <code>linux</code> 群组：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Gemfile</span></span><br><span class="line">group <span class="symbol">:darwin</span> <span class="keyword">do</span></span><br><span class="line">  gem <span class="string">'rb-fsevent'</span></span><br><span class="line">  gem <span class="string">'growl'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">group <span class="symbol">:linux</span> <span class="keyword">do</span></span><br><span class="line">  gem <span class="string">'rb-inotify'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  要在对的环境获得合适的 gem，添加以下代码至 <code>config/application.rb</code> ：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">platform = <span class="constant">RUBY_PLATFORM</span>.match(<span class="regexp">/(linux|darwin)/</span>)[<span class="number">0</span>].to_sym</span><br><span class="line"><span class="constant">Bundler</span>.<span class="keyword">require</span>(platform)</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要把 <code>Gemfile.lock</code> 文件从版本控制里移除。这不是随机产生的文件 - 它确保你所有的组员执行 <code>bundle install</code> 时，获得相同版本的 gem 。</p>
</li>
</ul>
<h2 id="u65E0_u4EF7_u7684_Gems"><a href="#u65E0_u4EF7_u7684_Gems" class="headerlink" title="无价的 Gems"></a>无价的 Gems</h2><p>一个最重要的编程理念是 “不要重造轮子！” 。若你遇到一个特定问题，你应该要在你开始前，看一下是否有存在的解决方案。下面是一些在很多 Rails 项目中 “无价的” gem 列表（全部兼容 Rails 3.1）：</p>
<ul>
<li><a href="https://github.com/gregbell/active_admin" target="_blank" rel="external">active_admin</a> - 有了 ActiveAdmin，创建 Rails 应用的管理界面就像儿戏。你会有一个很好的仪表盘，图形化 CRUD 界面以及更多东西。非常灵活且可客制化。</li>
<li><a href="https://github.com/charliesome/better_errors" target="_blank" rel="external">better_errors</a> - Better Errors 用更好更有效的错误页面，取代了 Rails 标准的错误页面。不仅可用在 Rails，任何将 Rack 当作中间件的 app 都可使用。</li>
<li><a href="https://github.com/flyerhzm/bullet" target="_blank" rel="external">bullet</a> - Bullet 就是为了帮助提升应用的效能（通过减少查询）而打造的 gem。会在你开发应用时，替你注意你的查询，并在需要 eager loading (N+1 查询)时、或是你在不必要的情况使用 eager loading 时，或是在应该要使用 counter cache 时，都会提醒你。</li>
<li><a href="https://github.com/ryanb/cancan" target="_blank" rel="external">cancan</a> - CanCan 是一个权限管理的 gem，<br>让你可以管制用户可存取的支援。所有的授权都定义在一个档案里（ability.rb），并提供许多方便的方法，让你检查及确保整个应用内权限是否是可得的。</li>
<li><a href="https://github.com/jnicklas/capybara" target="_blank" rel="external">capybara</a> - Capybara 旨在简化整合测试 Rack 应用的过程，像是 Rails、Sinatra 或 Merb。Capybara 模拟了真实用户使用 web 应用的互动。 它与你测试在运行的驱动无关，并原生搭载 Rack::Test 及 Selenium 支持。透过外部 gem 支持 HtmlUnit、WebKit 及 env.js 。与 RSpec &amp; Cucumber 一起使用时工作良好。</li>
<li><a href="https://github.com/jnicklas/carrierwave" target="_blank" rel="external">carrierwave</a> - Rails 最后一个文件上传解决方案。支持上传档案（及很多其它的酷玩意儿的）的本地储存与云储存。图片后处理与 ImageMagick 整合得非常好。</li>
<li><a href="https://github.com/bcardarella/client_side_validations" target="_blank" rel="external">client_side_validations</a> -<br>一个美妙的 gem，替你从现有的服务器端模型验证自动产生 Javascript 用户端验证。高度推荐！</li>
<li><a href="https://github.com/chriseppstein/compass" target="_blank" rel="external">compass-rails</a> - 一个优秀的 gem，添加了某些 css 框架的支持。包括了 sass mixin 的蒐集，让你减少 css 文件的代码并帮你解决浏览器兼容问题。</li>
<li><a href="https://github.com/cucumber/cucumber-rails" target="_blank" rel="external">cucumber-rails</a> - Cucumber 是一个由 Ruby 所写，开发功能测试的顶级工具。 cucumber-rails 提供了 Cucumber 的 Rails 整合。</li>
<li><a href="https://github.com/plataformatec/devise" target="_blank" rel="external">devise</a> - Devise 是 Rails 应用的一个完整解决方案。多数情况偏好使用 devise 来开始你的客制验证方案。</li>
<li><a href="http://fabricationgem.org/" target="_blank" rel="external">fabrication</a> - 一个很好的假数据产生器（编辑者的选择）。</li>
<li><a href="https://github.com/thoughtbot/factory_girl" target="_blank" rel="external">factory_girl</a> - 另一个 Fabrication 的选择。一个成熟的假数据产生器。 Fabrication 的精神领袖先驱。</li>
<li><a href="https://github.com/EmmanuelOga/ffaker" target="_blank" rel="external">ffaker</a> - 实用的 gem 来产生仿造的数据（名字、地址，等等）。</li>
<li><a href="https://github.com/pauldix/feedzirra" target="_blank" rel="external">feedzirra</a> - 非常快速及灵活的 RSS 或 Atom 种子解析器。</li>
<li><a href="https://github.com/norman/friendly_id" target="_blank" rel="external">friendly_id</a> - 透过使用某些具描述性的模型属性，而不是使用 id，允许你创建人类可读的网址。</li>
<li><a href="https://github.com/svenfuchs/globalize3.git" target="_blank" rel="external">globalize3</a> - Globalize3 是 Globalize 的后继者，针对 ActiveRecord 3.x 设计。基于新的 I18n API 打造而成，并帮 ActiveRecord 模型添加了事务功能。</li>
<li><a href="https://github.com/guard/guard" target="_blank" rel="external">guard</a> - 极佳的 gem 监控文件变化及任务的调用。搭载了很多实用的扩充。远优于 autotest 与 <a href="https://github.com/mynyml/watchr" target="_blank" rel="external">watchr</a>。</li>
<li><a href="https://github.com/indirect/haml-rails" target="_blank" rel="external">haml-rails</a> - haml-rails 提供了 Haml 的 Rails 整合。</li>
<li><a href="http://haml-lang.com" target="_blank" rel="external">haml</a> - Haml 是一个简洁的模型语言，被很多人认为（包括我）远优于 Erb。</li>
<li><a href="https://github.com/amatsuda/kaminari" target="_blank" rel="external">kaminari</a> - 很棒的分页解决方案。</li>
<li><a href="https://github.com/notahat/machinist" target="_blank" rel="external">machinist</a> - 假数据不好玩，Machinist 才好玩。</li>
<li><a href="https://github.com/rspec/rspec-rails" target="_blank" rel="external">rspec-rails</a> - RSpec 是 Test::MiniTest 的取代者。我不高度推荐 RSpec。 rspec-rails 提供了 RSpec 的 Rails 整合。</li>
<li><a href="https://github.com/plataformatec/simple_form" target="_blank" rel="external">simple_form</a> - 一旦用过 simple_form（或 formatastic），你就不想听到关于 Rails 缺省的表单。它是一个创造表单很棒的DSL。</li>
<li><a href="https://github.com/fguillen/simplecov-rcov" target="_blank" rel="external">simplecov-rcov</a> - 为了 SimpleCov 打造的 RCov formatter。若你想使用 SimpleCov 搭配 Hudson 持续整合服务器，很有用。</li>
<li><a href="https://github.com/colszowka/simplecov" target="_blank" rel="external">simplecov</a> - 代码覆盖率工具。不像 RCov，完全兼容 Ruby 1.9。产生精美的报告。必须用！</li>
<li><a href="http://slim-lang.com" target="_blank" rel="external">slim</a> - Slim 是一个简洁的模版语言，被视为是远远优于 HAML(Erb 就更不用说了)的语言。唯一会阻止我大规模地使用它的是，主流 IDE 及编辑器对它的支持不好。但它的效能是非凡的。</li>
<li><a href="https://github.com/sporkrb/spork" target="_blank" rel="external">spork</a> - 一个给测试框架（RSpec 或 现今 Cucumber）用的 DRb 服务器，每次运行前确保分支出一个乾净的测试状态。 简单的说，预载很多测试环境的结果是大幅降低你的测试启动时间，绝对必须用！</li>
<li><a href="https://github.com/sunspot/sunspot" target="_blank" rel="external">sunspot</a> - 基于 SOLR 的全文检索引擎。</li>
</ul>
<p>这不是完整的清单，以及其它的 gem 也可以在之后加进来。以上清单上的所有 gems 皆经测试，处于活跃开发阶段，有社群以及代码的质量很高。</p>
<h2 id="u7F3A_u9677_u7684_Gems"><a href="#u7F3A_u9677_u7684_Gems" class="headerlink" title="缺陷的 Gems"></a>缺陷的 Gems</h2><p>这是一个有问题的或被别的 gem 取代的 gem 清单。你应该在你的项目里避免使用它们。</p>
<ul>
<li><a href="http://rmagick.rubyforge.org/" target="_blank" rel="external">rmagick</a> - 这个 gem 因大量消耗内存而声名狼藉。使用 <a href="https://github.com/probablycorey/mini_magick" target="_blank" rel="external">minimagick</a> 来取代。</li>
<li><a href="http://www.zenspider.com/ZSS/Products/ZenTest/" target="_blank" rel="external">autotest</a> - 自动测试的老旧解决方案。远不如 guard 及 <a href="https://github.com/mynyml/watchr" target="_blank" rel="external">watchr</a>。</li>
<li><a href="https://github.com/relevance/rcov" target="_blank" rel="external">rcov</a> - 代码覆盖率工具，不兼容 Ruby 1.9。使用 <a href="https://github.com/colszowka/simplecov" target="_blank" rel="external">SimpleCov</a> 来取代。</li>
<li><a href="https://github.com/cowboyd/therubyracer" target="_blank" rel="external">therubyracer</a> - 极度不鼓励在生产模式使用这个 gem，它消耗大量的内存。我会推荐使用 <code>node.js</code> 来取代。</li>
</ul>
<p>这仍是一个完善中的清单。请告诉我受人欢迎但有缺陷的 gems 。</p>
<h2 id="u7BA1_u7406_u8FDB_u7A0B"><a href="#u7BA1_u7406_u8FDB_u7A0B" class="headerlink" title="管理进程"></a>管理进程</h2><ul>
<li>若你的项目依赖各种外部的进程使用 <a href="https://github.com/ddollar/foreman" target="_blank" rel="external">foreman</a> 来管理它们。</li>
</ul>
<h1 id="u6D4B_u8BD5_Rails__u5E94_u7528"><a href="#u6D4B_u8BD5_Rails__u5E94_u7528" class="headerlink" title="测试 Rails 应用"></a>测试 Rails 应用</h1><p>也许 BDD 方法是实作一个新功能最好的方法。你从开始写一些高阶的测试（通常使用 Cucumber），然后使用这些测试来驱使你实作功能。一开始你给功能的视图写测试，并使用这些测试来创建相关的视图。之后，你创建丢给视图数据的控制器测试来实现控制器。最后你实作模型的测试以及模型自身。</p>
<h2 id="Cucumber"><a href="#Cucumber" class="headerlink" title="Cucumber"></a>Cucumber</h2><ul>
<li>用 <code>@wip</code> （工作进行中）标签标记你未完成的场景。这些场景不纳入考虑，且不标记为测试失败。当完成一个未完成场景且功能测试通过时，为了把此场景加至测试套件里，应该移除 <code>@wip</code> 标签。</li>
<li>配置你的缺省配置文件，排除掉标记为 <code>@javascript</code> 的场景。它们使用浏览器来测试，推荐停用它们来增加一般场景的执行速度。</li>
<li><p>替标记著 <code>@javascript</code> 的场景配置另一个配置文件。</p>
<ul>
<li><p>配置文件可在 <code>cucumber.yml</code> 文件里配置。</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件的定义：</span></span><br><span class="line"><span class="symbol">profile_name:</span> --tags <span class="variable">@tag_name</span></span><br></pre></td></tr></table></figure>
</code></pre></li>
<li><p>带指令运行一个配置文件：</p>
<pre><code><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cucumber -<span class="tag">p</span> profile_name</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
</li>
<li><p>若使用 <a href="http://fabricationgem.org/" target="_blank" rel="external">fabrication</a> 来替换假数据 (fixtures)，使用预定义的 <a href="http://fabricationgem.org/#!cucumber-steps" target="_blank" rel="external">fabrication steps</a>。</p>
</li>
<li>不要使用旧版的 <code>web_steps.rb</code> 步骤定义！<a href="http://aslakhellesoy.com/post/11055981222/the-training-wheels-came-off" target="_blank" rel="external">最新版 Cucumber 已移除 web steps</a>，使用它们导致冗赘的场景，而且它并没有正确地反映出应用的领域。</li>
<li>当检查一元素的可视文字时，检查元素的文字而不是检查 id。这样可以查出 i18n 的问题。</li>
<li><p>给同种类对象创建不同的功能特色：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">Feature</span><span class="symbol">:</span> <span class="constant">Articles</span></span><br><span class="line"><span class="comment"># ... 功能实作 ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">Feature</span><span class="symbol">:</span> <span class="constant">Article</span> <span class="constant">Editing</span></span><br><span class="line"><span class="comment"># ... 功能实作 ...</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Feature</span><span class="symbol">:</span> <span class="constant">Article</span> <span class="constant">Publishing</span></span><br><span class="line"><span class="comment"># ... 功能实作 ...</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Feature</span><span class="symbol">:</span> <span class="constant">Article</span> <span class="constant">Search</span></span><br><span class="line"><span class="comment"># ... 功能实作 ...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>每一个功能有三个主要成分：</p>
<ul>
<li>Title</li>
<li>Narrative - 简短说明这个特色关于什么。</li>
<li>Acceptance criteria - 每个由独立步骤组成的一套场景。</li>
</ul>
</li>
<li><p>最常见的格式称为 Connextra 格式。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">In</span> order to [benefit] ...</span><br><span class="line"><span class="constant">A</span> [stakeholder]...</span><br><span class="line"><span class="constant">Wants</span> to [feature] ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这是最常见但不是要求的格式，叙述可以是依赖功能复杂度的任何文字。</p>
<ul>
<li><p>自由地使用场景概述使你的场景备作它用 (keep your scenarios DRY)。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Scenario</span> <span class="constant">Outline</span><span class="symbol">:</span> <span class="constant">User</span> cannot register with invalid e-mail</span><br><span class="line">  <span class="constant">When</span> <span class="constant">I</span> try to register with an email <span class="string">"&lt;email&gt;"</span></span><br><span class="line">  <span class="constant">Then</span> <span class="constant">I</span> should see the error message <span class="string">"&lt;error&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Examples</span><span class="symbol">:</span></span><br><span class="line">  |email         |error                 |</span><br><span class="line">  |              |<span class="constant">The</span> e-mail is required|</span><br><span class="line">  |invalid email |is <span class="keyword">not</span> a valid e-mail |</span><br></pre></td></tr></table></figure>
</li>
<li><p>场景的步骤放在 <code>step_definitions</code> 目录下的 <code>.rb</code> 文件。步骤文件命名惯例为 <code>[description]_steps.rb</code>。步骤根据不同的标准放在不同的文件里。每一个功能可能有一个步骤文件 (<code>home_page_steps.rb</code>)<br>。也可能给每个特定对象的功能，建一个步骤文件 (<code>articles_steps.rb</code>)。</p>
</li>
<li><p>使用多行步骤参数来避免重复</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">场景<span class="symbol">:</span> <span class="constant">User</span> profile</span><br><span class="line">  <span class="constant">Given</span> <span class="constant">I</span> am logged <span class="keyword">in</span> as a user <span class="string">"John Doe"</span> with an e-mail <span class="string">"user@test.com"</span></span><br><span class="line">  <span class="constant">When</span> <span class="constant">I</span> go to my profile</span><br><span class="line">  <span class="constant">Then</span> <span class="constant">I</span> should see the following <span class="symbol">information:</span></span><br><span class="line">    |<span class="constant">First</span> name|<span class="constant">John</span>         |</span><br><span class="line">    |<span class="constant">Last</span> name |<span class="constant">Doe</span>          |</span><br><span class="line">    |<span class="constant">E</span>-mail    |user<span class="variable">@test</span>.com|</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤:</span></span><br><span class="line"><span class="constant">Then</span> /^<span class="constant">I</span> should see the following <span class="symbol">information:</span><span class="variable">$/</span> <span class="keyword">do</span> |table|</span><br><span class="line">  table.raw.each <span class="keyword">do</span> |field, value|</span><br><span class="line">    find_field(field).value.should =~ <span class="regexp">/<span class="subst">#&#123;value&#125;</span>/</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用复合步骤使场景备作它用 (Keep your scenarios DRY)</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="constant">When</span> <span class="constant">I</span> subscribe <span class="keyword">for</span> news from the category <span class="string">"Technical News"</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤:</span></span><br><span class="line"><span class="constant">When</span> /^<span class="constant">I</span> subscribe <span class="keyword">for</span> news from the category <span class="string">"([^"</span>]*)<span class="string">"$/ do |category|</span><br><span class="line">  steps %Q&#123;</span><br><span class="line">    When I go to the news categories page</span><br><span class="line">    And I select the category <span class="subst">#&#123;category&#125;</span></span><br><span class="line">    And I click the button "</span><span class="constant">Subscribe</span> <span class="keyword">for</span> this category<span class="string">"</span><br><span class="line">    And I confirm the subscription</span><br><span class="line">  &#125;</span><br><span class="line">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>总是使用 Capybara 否定匹配来取代正面情况搭配 should_not，它们会在给定的超时时重试匹配，允许你测试 ajax 动作。 见 <a href="https://github.com/jnicklas/capybara" target="_blank" rel="external">Capybara 的 读我文件</a>获得更多说明。</p>
</li>
</ul>
<h2 id="RSpec"><a href="#RSpec" class="headerlink" title="RSpec"></a>RSpec</h2><ul>
<li><p>一个例子仅用一个期望值。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">describe <span class="constant">ArticlesController</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment">#...</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">'GET new'</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">'assigns new article and renders the new article template'</span> <span class="keyword">do</span></span><br><span class="line">      get <span class="symbol">:new</span></span><br><span class="line">      assigns[<span class="symbol">:article</span>].should be_a_new <span class="constant">Article</span></span><br><span class="line">      response.should render_template <span class="symbol">:new</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">describe <span class="constant">ArticlesController</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment">#...</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">'GET new'</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">'assigns a new article'</span> <span class="keyword">do</span></span><br><span class="line">      get <span class="symbol">:new</span></span><br><span class="line">      assigns[<span class="symbol">:article</span>].should be_a_new <span class="constant">Article</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    it <span class="string">'renders the new article template'</span> <span class="keyword">do</span></span><br><span class="line">      get <span class="symbol">:new</span></span><br><span class="line">      response.should render_template <span class="symbol">:new</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>大量使用 <code>descibe</code> 及 <code>context</code> 。</p>
</li>
<li><p>如下地替 <code>describe</code> 区块命名：</p>
<ul>
<li>非方法使用 “description”</li>
<li>实例方法使用井字号 “#method”</li>
<li><p>类别方法使用点 “.method”</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">summary</span></span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">latest</span></span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the spec...</span></span><br><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  describe <span class="string">'#summary'</span> <span class="keyword">do</span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">'.latest'</span> <span class="keyword">do</span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用 <a href="http://fabricationgem.org/" target="_blank" rel="external">fabricators</a> 来创建测试对象。</p>
</li>
<li><p>大量使用 mocks 与 stubs。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mocking 一个模型</span></span><br><span class="line">article = mock_model(<span class="constant">Article</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># stubbing 一个方法</span></span><br><span class="line"><span class="constant">Article</span>.stub(<span class="symbol">:find</span>).with(article.id).and_return(article)</span><br></pre></td></tr></table></figure>
</li>
<li><p>当 mocking 一个模型时，使用 <code>as_null_object</code> 方法。它告诉输出仅监听我们预期的讯息，并忽略其它的讯息。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">article = mock_model(<span class="constant">Article</span>).as_null_object</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>let</code> 区块而不是 <code>before(:each)</code> 区块替 spec 例子创建数据。<code>let</code> 区块会被懒惰求值。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用这个：</span></span><br><span class="line">let(<span class="symbol">:article</span>) &#123; <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ... 而不是这个：</span></span><br><span class="line">before(<span class="symbol">:each</span>) &#123; <span class="variable">@article</span> = <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当可能时，使用 <code>subject</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  subject &#123; <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line"></span><br><span class="line">  it <span class="string">'is not published on creation'</span> <span class="keyword">do</span></span><br><span class="line">    subject.should_not be_published</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果可能的话，使用 <code>specify</code>。它是 <code>it</code> 的同义词，但在没 docstring 的情况下可读性更高。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  before &#123; <span class="variable">@article</span> = <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line"></span><br><span class="line">  it <span class="string">'is not published on creation'</span> <span class="keyword">do</span></span><br><span class="line">    <span class="variable">@article</span>.should_not be_published</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  let(<span class="symbol">:article</span>) &#123; <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line">  specify &#123; article.should_not be_published &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当可能时，使用 <code>its</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  subject &#123; <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line"></span><br><span class="line">  it <span class="string">'has the current date as creation date'</span> <span class="keyword">do</span></span><br><span class="line">    subject.creation_date.should == <span class="constant">Date</span>.today</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  subject &#123; <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line">  its(<span class="symbol">:creation_date</span>) &#123; should == <span class="constant">Date</span>.today &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Use <code>shared_examples</code> if you want to create a spec group that can be shared by many other tests.</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># bad</span></span><br><span class="line">    describe <span class="constant">Array</span> <span class="keyword">do</span></span><br><span class="line">      subject &#123; <span class="constant">Array</span>.new [<span class="number">7</span>, <span class="number">2</span>, <span class="number">4</span>] &#125;</span><br><span class="line"></span><br><span class="line">      context <span class="string">"initialized with 3 items"</span> <span class="keyword">do</span></span><br><span class="line">        its(<span class="symbol">:size</span>) &#123; should eq(<span class="number">3</span>) &#125;</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    describe <span class="constant">Set</span> <span class="keyword">do</span></span><br><span class="line">      subject &#123; <span class="constant">Set</span>.new [<span class="number">7</span>, <span class="number">2</span>, <span class="number">4</span>] &#125;</span><br><span class="line"></span><br><span class="line">      context <span class="string">"initialized with 3 items"</span> <span class="keyword">do</span></span><br><span class="line">        its(<span class="symbol">:size</span>) &#123; should eq(<span class="number">3</span>) &#125;</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#good</span></span><br><span class="line">    shared_examples <span class="string">"a collection"</span> <span class="keyword">do</span></span><br><span class="line">      subject &#123; described_class.new([<span class="number">7</span>, <span class="number">2</span>, <span class="number">4</span>]) &#125;</span><br><span class="line"></span><br><span class="line">      context <span class="string">"initialized with 3 items"</span> <span class="keyword">do</span></span><br><span class="line">        its(<span class="symbol">:size</span>) &#123; should eq(<span class="number">3</span>) &#125;</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    describe <span class="constant">Array</span> <span class="keyword">do</span></span><br><span class="line">      it_behaves_like <span class="string">"a collection"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    describe <span class="constant">Set</span> <span class="keyword">do</span></span><br><span class="line">      it_behaves_like <span class="string">"a collection"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 视图</span></span><br><span class="line"></span><br><span class="line">* 视图测试的目录结构要与 <span class="string">`app/views`</span> 之中的相符。 举例来说，在 <span class="string">`app/views/users`</span> 视图被放在 <span class="string">`spec/views/users`</span>。</span><br><span class="line">* 视图测试的命名惯例是添加 <span class="string">`_spec.rb`</span> 至视图名字之后，举例来说，视图 <span class="string">`_form.html.haml`</span> 有一个对应的测试叫做 <span class="string">`_form.html.haml_spec.rb`</span>。</span><br><span class="line">* 每个视图测试文件都需要 <span class="string">`spec_helper.rb`</span>。</span><br><span class="line">* 外部描述区块使用不含 <span class="string">`app/views`</span> 部分的视图路径。 <span class="string">`render`</span> 方法没有传入参数时，是这么使用的。</span><br><span class="line"></span><br><span class="line">    <span class="string">``</span><span class="string">`Ruby</span><br><span class="line">    # spec/views/articles/new.html.haml_spec.rb</span><br><span class="line">    require 'spec_helper'</span><br><span class="line"></span><br><span class="line">    describe 'articles/new.html.haml' do</span><br><span class="line">      # ...</span><br><span class="line">    end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>永远在视图测试来 mock 模型。视图的目的只是显示信息。</p>
</li>
<li><p><code>assign</code> 方法提供由控制器提供视图使用的实例变量(instance variable)。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># spec/views/articles/edit.html.haml_spec.rb</span></span><br><span class="line">describe <span class="string">'articles/edit.html.haml'</span> <span class="keyword">do</span></span><br><span class="line">it <span class="string">'renders the form for a new article creation'</span> <span class="keyword">do</span></span><br><span class="line">  assign(</span><br><span class="line">    <span class="symbol">:article</span>,</span><br><span class="line">    mock_model(<span class="constant">Article</span>).as_new_record.as_null_object</span><br><span class="line">  )</span><br><span class="line">  render</span><br><span class="line">  rendered.should have_selector(<span class="string">'form'</span>,</span><br><span class="line">    <span class="symbol">method:</span> <span class="string">'post'</span>,</span><br><span class="line">    <span class="symbol">action:</span> articles_path</span><br><span class="line">  ) <span class="keyword">do</span> |form|</span><br><span class="line">    form.should have_selector(<span class="string">'input'</span>, <span class="symbol">type:</span> <span class="string">'submit'</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>偏好 capybara 否定情况选择器，胜于搭配正面情况的 should_not 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">page.should_not have_selector(<span class="string">'input'</span>, <span class="symbol">type:</span> <span class="string">'submit'</span>)</span><br><span class="line">page.should_not have_xpath(<span class="string">'tr'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">page.should have_no_selector(<span class="string">'input'</span>, <span class="symbol">type:</span> <span class="string">'submit'</span>)</span><br><span class="line">page.should have_no_xpath(<span class="string">'tr'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>当一个视图使用 helper 方法时，这些方法需要被 stubbed。Stubbing 这些 helper 方法是在 <code>template</code> 完成的：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/helpers/articles_helper.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticlesHelper</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">formatted_date</span><span class="params">(date)</span></span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># app/views/articles/show.html.haml</span></span><br><span class="line">= <span class="string">"Published at: <span class="subst">#&#123;formatted_date(<span class="variable">@article</span>.published_at)&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># spec/views/articles/show.html.haml_spec.rb</span></span><br><span class="line">describe <span class="string">'articles/show.html.haml'</span> <span class="keyword">do</span></span><br><span class="line">  it <span class="string">'displays the formatted date of article publishing'</span> <span class="keyword">do</span></span><br><span class="line">    article = mock_model(<span class="constant">Article</span>, <span class="symbol">published_at:</span> <span class="constant">Date</span>.new(<span class="number">2012</span>, <span class="number">01</span>, <span class="number">01</span>))</span><br><span class="line">    assign(<span class="symbol">:article</span>, article)</span><br><span class="line"></span><br><span class="line">    template.stub(<span class="symbol">:formatted_date</span>).with(article.published_at).and_return(<span class="string">'01.01.2012'</span>)</span><br><span class="line"></span><br><span class="line">    render</span><br><span class="line">    rendered.should have_content(<span class="string">'Published at: 01.01.2012'</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>spec/helpers</code> 目录的 helper specs 是与视图 specs 分开的。</p>
</li>
</ul>
<h3 id="u63A7_u5236_u5668-1"><a href="#u63A7_u5236_u5668-1" class="headerlink" title="控制器"></a>控制器</h3><ul>
<li>Mock 模型及 stub 他们的方法。测试控制器时不应依赖建模。</li>
<li><p>仅测试控制器需负责的行为：</p>
<ul>
<li>执行特定的方法</li>
<li>从动作返回的数据 - assigns, 等等。</li>
<li><p>从动作返回的结果 - template render, redirect, 等等。</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常用的控制器 spec 示例</span></span><br><span class="line"><span class="comment"># spec/controllers/articles_controller_spec.rb</span></span><br><span class="line"><span class="comment"># 我们只对控制器应执行的动作感兴趣</span></span><br><span class="line"><span class="comment"># 所以我们 mock 模型及 stub 它的方法</span></span><br><span class="line"><span class="comment"># 并且专注在控制器该做的事情上</span></span><br><span class="line"></span><br><span class="line">describe <span class="constant">ArticlesController</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># 模型将会在测试中被所有控制器的方法所使用</span></span><br><span class="line">  let(<span class="symbol">:article</span>) &#123; mock_model(<span class="constant">Article</span>) &#125;</span><br><span class="line"></span><br><span class="line">  describe <span class="string">'POST create'</span> <span class="keyword">do</span></span><br><span class="line">    before &#123; <span class="constant">Article</span>.stub(<span class="symbol">:new</span>).and_return(article) &#125;</span><br><span class="line"></span><br><span class="line">    it <span class="string">'creates a new article with the given attributes'</span> <span class="keyword">do</span></span><br><span class="line">      <span class="constant">Article</span>.should_receive(<span class="symbol">:new</span>).with(<span class="symbol">title:</span> <span class="string">'The New Article Title'</span>).and_return(article)</span><br><span class="line">      post <span class="symbol">:create</span>, <span class="symbol">message:</span> &#123; <span class="symbol">title:</span> <span class="string">'The New Article Title'</span> &#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    it <span class="string">'saves the article'</span> <span class="keyword">do</span></span><br><span class="line">      article.should_receive(<span class="symbol">:save</span>)</span><br><span class="line">      post <span class="symbol">:create</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    it <span class="string">'redirects to the Articles index'</span> <span class="keyword">do</span></span><br><span class="line">      article.stub(<span class="symbol">:save</span>)</span><br><span class="line">      post <span class="symbol">:create</span></span><br><span class="line">      response.should redirect_to(<span class="symbol">action:</span> <span class="string">'index'</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
</li>
<li><p>当控制器根据不同参数有不同行为时，使用 context。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个在控制器中使用 context 的典型例子是，对象正确保存时，使用创建，保存失败时更新。</span></span><br><span class="line"></span><br><span class="line">describe <span class="constant">ArticlesController</span> <span class="keyword">do</span></span><br><span class="line">  let(<span class="symbol">:article</span>) &#123; mock_model(<span class="constant">Article</span>) &#125;</span><br><span class="line"></span><br><span class="line">  describe <span class="string">'POST create'</span> <span class="keyword">do</span></span><br><span class="line">    before &#123; <span class="constant">Article</span>.stub(<span class="symbol">:new</span>).and_return(article) &#125;</span><br><span class="line"></span><br><span class="line">    it <span class="string">'creates a new article with the given attributes'</span> <span class="keyword">do</span></span><br><span class="line">      <span class="constant">Article</span>.should_receive(<span class="symbol">:new</span>).with(<span class="symbol">title:</span> <span class="string">'The New Article Title'</span>).and_return(article)</span><br><span class="line">      post <span class="symbol">:create</span>, <span class="symbol">article:</span> &#123; <span class="symbol">title:</span> <span class="string">'The New Article Title'</span> &#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    it <span class="string">'saves the article'</span> <span class="keyword">do</span></span><br><span class="line">      article.should_receive(<span class="symbol">:save</span>)</span><br><span class="line">      post <span class="symbol">:create</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    context <span class="string">'when the article saves successfully'</span> <span class="keyword">do</span></span><br><span class="line">      before &#123; article.stub(<span class="symbol">:save</span>).and_return(<span class="keyword">true</span>) &#125;</span><br><span class="line"></span><br><span class="line">      it <span class="string">'sets a flash[:notice] message'</span> <span class="keyword">do</span></span><br><span class="line">        post <span class="symbol">:create</span></span><br><span class="line">        flash[<span class="symbol">:notice</span>].should eq(<span class="string">'The article was saved successfully.'</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      it <span class="string">'redirects to the Articles index'</span> <span class="keyword">do</span></span><br><span class="line">        post <span class="symbol">:create</span></span><br><span class="line">        response.should redirect_to(<span class="symbol">action:</span> <span class="string">'index'</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    context <span class="string">'when the article fails to save'</span> <span class="keyword">do</span></span><br><span class="line">      before &#123; article.stub(<span class="symbol">:save</span>).and_return(<span class="keyword">false</span>) &#125;</span><br><span class="line"></span><br><span class="line">      it <span class="string">'assigns @article'</span> <span class="keyword">do</span></span><br><span class="line">        post <span class="symbol">:create</span></span><br><span class="line">        assigns[<span class="symbol">:article</span>].should be_eql(article)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      it <span class="string">'re-renders the "new" template'</span> <span class="keyword">do</span></span><br><span class="line">        post <span class="symbol">:create</span></span><br><span class="line">        response.should render_template(<span class="string">'new'</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="u6A21_u578B-1"><a href="#u6A21_u578B-1" class="headerlink" title="模型"></a>模型</h3><ul>
<li>不要在自己的测试里 mock 模型。</li>
<li>使用捏造的东西来创建真的对象</li>
<li>Mock 别的模型或子对象是可接受的。</li>
<li><p>在测试里建立所有例子的模型来避免重复。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  let(<span class="symbol">:article</span>) &#123; <span class="constant">Fabricate</span>(<span class="symbol">:article</span>) &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>加入一个例子确保捏造的模型是可行的。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  it <span class="string">'is valid with valid attributes'</span> <span class="keyword">do</span></span><br><span class="line">    article.should be_valid</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当测试验证时，使用 <code>have(x).errors_on</code> 来指定要被验证的属性。使用 <code>be_valid</code> 不保证问题在目的的属性。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">describe <span class="string">'#title'</span> <span class="keyword">do</span></span><br><span class="line">  it <span class="string">'is required'</span> <span class="keyword">do</span></span><br><span class="line">    article.title = <span class="keyword">nil</span></span><br><span class="line">    article.should_not be_valid</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 偏好</span></span><br><span class="line">describe <span class="string">'#title'</span> <span class="keyword">do</span></span><br><span class="line">  it <span class="string">'is required'</span> <span class="keyword">do</span></span><br><span class="line">    article.title = <span class="keyword">nil</span></span><br><span class="line">    article.should have(<span class="number">1</span>).error_on(<span class="symbol">:title</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>替每个有验证的属性加另一个 <code>describe</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  describe <span class="string">'#title'</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">'is required'</span> <span class="keyword">do</span></span><br><span class="line">      article.title = <span class="keyword">nil</span></span><br><span class="line">      article.should have(<span class="number">1</span>).error_on(<span class="symbol">:title</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当测试模型属性的独立性时，把其它对象命名为 <code>another_object</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="constant">Article</span> <span class="keyword">do</span></span><br><span class="line">  describe <span class="string">'#title'</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">'is unique'</span> <span class="keyword">do</span></span><br><span class="line">      another_article = <span class="constant">Fabricate</span>.build(<span class="symbol">:article</span>, <span class="symbol">title:</span> article.title)</span><br><span class="line">      article.should have(<span class="number">1</span>).error_on(<span class="symbol">:title</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Mailers-1"><a href="#Mailers-1" class="headerlink" title="Mailers"></a>Mailers</h3><ul>
<li>在 Mailer 测试的模型应该要被 mock。 Mailer 不应依赖建模。</li>
<li><p>Mailer 的测试应该确认如下：</p>
<ul>
<li>这个 subject 是正确的</li>
<li>这个 receiver e-mail 是正确的</li>
<li>这个 e-mail 寄送至对的邮件地址</li>
<li><p>这个 e-mail 包含了需要的信息</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="constant">SubscriberMailer</span></span><br><span class="line">  let(<span class="symbol">:subscriber</span>) &#123; mock_model(<span class="constant">Subscription</span>, <span class="symbol">email:</span> <span class="string">'johndoe@test.com'</span>, <span class="symbol">name:</span> <span class="string">'John Doe'</span>) &#125;</span><br><span class="line"></span><br><span class="line">  describe <span class="string">'successful registration email'</span> <span class="keyword">do</span></span><br><span class="line">    subject &#123; <span class="constant">SubscriptionMailer</span>.successful_registration_email(subscriber) &#125;</span><br><span class="line"></span><br><span class="line">    its(<span class="symbol">:subject</span>) &#123; should == <span class="string">'Successful Registration!'</span> &#125;</span><br><span class="line">    its(<span class="symbol">:from</span>) &#123; should == [<span class="string">'info@your_site.com'</span>] &#125;</span><br><span class="line">    its(<span class="symbol">:to</span>) &#123; should == [subscriber.email] &#125;</span><br><span class="line"></span><br><span class="line">    it <span class="string">'contains the subscriber name'</span> <span class="keyword">do</span></span><br><span class="line">      subject.body.encoded.should match(subscriber.name)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="Uploaders"><a href="#Uploaders" class="headerlink" title="Uploaders"></a>Uploaders</h3><ul>
<li><p>我们如何测试上传器是否正确地调整大小。这里是一个 <a href="https://github.com/jnicklas/carrierwave" target="_blank" rel="external">carrierwave</a> 图片上传器的示例 spec：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rspec/uploaders/person_avatar_uploader_spec.rb</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'spec_helper'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'carrierwave/test/matchers'</span></span><br><span class="line"></span><br><span class="line">describe <span class="constant">PersonAvatarUploader</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">CarrierWave::Test::Matchers</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 在执行例子前启用图片处理</span></span><br><span class="line">  before(<span class="symbol">:all</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="constant">UserAvatarUploader</span>.enable_processing = <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 创建一个新的 uploader。模型被模仿为不依赖建模时的上传及调整图片。</span></span><br><span class="line">  before(<span class="symbol">:each</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="variable">@uploader</span> = <span class="constant">PersonAvatarUploader</span>.new(mock_model(<span class="constant">Person</span>).as_null_object)</span><br><span class="line">    <span class="variable">@uploader</span>.store!(<span class="constant">File</span>.open(path_to_file))</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 执行完例子时停用图片处理</span></span><br><span class="line">  after(<span class="symbol">:all</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="constant">UserAvatarUploader</span>.enable_processing = <span class="keyword">false</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 测试图片是否不比给定的维度长</span></span><br><span class="line">  context <span class="string">'the default version'</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">'scales down an image to be no larger than 256 by 256 pixels'</span> <span class="keyword">do</span></span><br><span class="line">      <span class="variable">@uploader</span>.should be_no_larger_than(<span class="number">256</span>, <span class="number">256</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 测试图片是否有确切的维度</span></span><br><span class="line">  context <span class="string">'the thumb version'</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">'scales down an image to be exactly 64 by 64 pixels'</span> <span class="keyword">do</span></span><br><span class="line">      <span class="variable">@uploader</span>.thumb.should have_dimensions(<span class="number">64</span>, <span class="number">64</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="u5EF6_u4F38_u9605_u8BFB"><a href="#u5EF6_u4F38_u9605_u8BFB" class="headerlink" title="延伸阅读"></a>延伸阅读</h1><p>有几个绝妙讲述 Rails 风格的资源，若有闲暇时应当考虑延伸阅读：</p>
<ul>
<li><a href="http://www.amazon.com/Rails-Way-Addison-Wesley-Professional-Ruby/dp/0321601661" target="_blank" rel="external">The Rails 3 Way</a></li>
<li><a href="http://guides.rubyonrails.org/" target="_blank" rel="external">Ruby on Rails Guides</a></li>
<li><a href="http://pragprog.com/book/achbd/the-rspec-book" target="_blank" rel="external">The RSpec Book</a></li>
<li><a href="http://pragprog.com/book/hwcuc/the-cucumber-book" target="_blank" rel="external">The Cucumber Book</a></li>
<li><a href="https://leanpub.com/everydayrailsrspec" target="_blank" rel="external">Everyday Rails Testing with RSpec</a></li>
</ul>
<h1 id="u8D21_u732E"><a href="#u8D21_u732E" class="headerlink" title="贡献"></a>贡献</h1><p>在本指南所写的每个东西都不是定案。这只是我渴望想与同样对 Rails 编码风格有兴趣的大家一起工作，以致于最终我们可以替整个 Ruby 社群创造一个有益的资源。</p>
<p>欢迎开票或发送一个带有改进的更新请求。在此提前感谢你的帮助！</p>
<h1 id="u6388_u6743"><a href="#u6388_u6743" class="headerlink" title="授权"></a>授权</h1><p><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Creative Commons License"><br>This work is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/deed.zh" target="_blank" rel="external">Creative Commons Attribution 3.0 Unported License</a></p>
<h1 id="u53E3_u8033_u76F8_u4F20"><a href="#u53E3_u8033_u76F8_u4F20" class="headerlink" title="口耳相传"></a>口耳相传</h1><p>一份社群驱动的风格指南，对一个社群来说，只是让人知道有这个社群。微博转发这份指南，分享给你的朋友或同事。我们得到的每个注解、建议或意见都可以让这份指南变得更好一点。而我们想要拥有的是最好的指南，不是吗？</p>
<p>共勉之,<br><br><a href="https://twitter.com/bbatsov" target="_blank" rel="external">Bozhidar</a></p>

      
      
    </div>
    
  </div>
  
    
<div class="copyright">
  <p><span>本文标题:</span><a href="/2016/01/26/2013-07-03-rails-style-guide/">Rails 风格指南</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 萧 的个人博客">萧</a></p>
  <p><span>发布时间:</span>2016年01月26日 - 20时38分</p>
  <p><span>最后更新:</span>2016年01月26日 - 20时38分</p>
  <p>
    <span>原始链接:</span><a href="/2016/01/26/2013-07-03-rails-style-guide/" title="Rails 风格指南">http://notes.seirhsiao.com/2016/01/26/2013-07-03-rails-style-guide/</a>
    <span class="btn" data-clipboard-text="原文: http://notes.seirhsiao.com/2016/01/26/2013-07-03-rails-style-guide/　　作者: 萧" title="点击复制文章链接">
        <i class="fa fa-clipboard"></i>
    </span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p>
  <script src="/js/clipboard.min.js"></script>
  <script> var clipboard = new Clipboard('.btn'); </script>
</div>
<style type="text/css">
  .copyright p .btn {
    margin-left: 1em;
  }
  .copyright:hover p .btn::after {
    content: "复制"
  }
  .copyright p .btn:hover {
      color: gray;
      cursor: pointer;
    };
</style>



<nav id="article-nav">
  
    <div id="article-nav-newer" class="article-nav-title">
      <a href="/2016/01/26/2013-07-02-ruby-style-guide/">
        Ruby 风格指南
      </a>
    </div>
  
  
    <div id="article-nav-older" class="article-nav-title">
      <a href="/2016/01/26/2013-06-14-setup-sonar/">
        Sonar及其eclipse插件的安装
      </a>
    </div>
  
</nav>

  
</article>

<!-- 默认显示文章目录，在文章---前输入toc: false关闭目录 -->
<!-- Show TOC and tocButton in default, Hide TOC via putting "toc: false" before "---" at [post].md -->
<div id="toc" class="toc-article">
<strong class="toc-title">文章目录</strong>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#u5E8F_u5E55"><span class="toc-number">1.</span> <span class="toc-text">序幕</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u76EE_u5F55"><span class="toc-number">2.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5F00_u53D1_Rails__u5E94_u7528_u7A0B_u5E8F"><span class="toc-number">3.</span> <span class="toc-text">开发 Rails 应用程序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u914D_u7F6E"><span class="toc-number">3.1.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u8DEF_u7531"><span class="toc-number">3.2.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u63A7_u5236_u5668"><span class="toc-number">3.3.</span> <span class="toc-text">控制器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6A21_u578B"><span class="toc-number">3.4.</span> <span class="toc-text">模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ActiveRecord"><span class="toc-number">3.4.1.</span> <span class="toc-text">ActiveRecord</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ActiveResource"><span class="toc-number">3.4.2.</span> <span class="toc-text">ActiveResource</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u8FC1_u79FB"><span class="toc-number">3.5.</span> <span class="toc-text">迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u89C6_u56FE"><span class="toc-number">3.6.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u56FD_u9645_u5316"><span class="toc-number">3.7.</span> <span class="toc-text">国际化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Assets"><span class="toc-number">3.8.</span> <span class="toc-text">Assets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mailers"><span class="toc-number">3.9.</span> <span class="toc-text">Mailers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bundler"><span class="toc-number">3.10.</span> <span class="toc-text">Bundler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u65E0_u4EF7_u7684_Gems"><span class="toc-number">3.11.</span> <span class="toc-text">无价的 Gems</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7F3A_u9677_u7684_Gems"><span class="toc-number">3.12.</span> <span class="toc-text">缺陷的 Gems</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7BA1_u7406_u8FDB_u7A0B"><span class="toc-number">3.13.</span> <span class="toc-text">管理进程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u6D4B_u8BD5_Rails__u5E94_u7528"><span class="toc-number">4.</span> <span class="toc-text">测试 Rails 应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cucumber"><span class="toc-number">4.1.</span> <span class="toc-text">Cucumber</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSpec"><span class="toc-number">4.2.</span> <span class="toc-text">RSpec</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u63A7_u5236_u5668-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6A21_u578B-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mailers-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">Mailers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Uploaders"><span class="toc-number">4.2.4.</span> <span class="toc-text">Uploaders</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u5EF6_u4F38_u9605_u8BFB"><span class="toc-number">5.</span> <span class="toc-text">延伸阅读</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u8D21_u732E"><span class="toc-number">6.</span> <span class="toc-text">贡献</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u6388_u6743"><span class="toc-number">7.</span> <span class="toc-text">授权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u53E3_u8033_u76F8_u4F20"><span class="toc-number">8.</span> <span class="toc-text">口耳相传</span></a></li></ol>
</div>
<style type="text/css">
  .left-col .switch-btn {
    display: none;
  }
  .left-col .switch-area {
    display: none;
  }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script type="text/javascript">
  var toc_button= document.getElementById("tocButton");
  var toc_div= document.getElementById("toc");
  /* Show or hide toc when click on tocButton.
  通过点击设置的按钮显示或者隐藏文章目录.*/
  toc_button.onclick=function(){
  if(toc_div.style.display=="none"){
  toc_div.style.display="block";
  toc_button.value="隐藏目录";
  document.getElementById("switch-btn").style.display="none";
  document.getElementById("switch-area").style.display="none";
  }
  else{
  toc_div.style.display="none";
  toc_button.value="显示目录";
  document.getElementById("switch-btn").style.display="block";
  document.getElementById("switch-area").style.display="block";
  }
  }
</script>


<div class="share">
	<div class="bdsharebuttonbox">
	<a href="#" class="bds_more" data-cmd="more"></a>
	<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
	<a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
	<a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
	<a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
	</div>
	<script>
	window._bd_share_config={
		"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	</script>
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/01/26/2013-07-03-rails-style-guide/" data-title="Rails 风格指南" data-url="http://notes.seirhsiao.com/2016/01/26/2013-07-03-rails-style-guide/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"hsiao-tech"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>






    <style type="text/css">
    #scroll {
      display: none;
    }
    </style>
    <div class="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#ds-thread" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
    </div>


  
  
    
    <div  class="post-nav-button">
    <a href="/2016/01/26/2013-07-02-ruby-style-guide/" title="上一篇: Ruby 风格指南">
    <i class="fa fa-angle-left"></i>
    </a>
    <a href="/2016/01/26/2013-06-14-setup-sonar/" title="下一篇: Sonar及其eclipse插件的安装">
    <i class="fa fa-angle-right"></i>
    </a>
    </div>
  



    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2016 萧
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/seirhsiao/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by 萧
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>