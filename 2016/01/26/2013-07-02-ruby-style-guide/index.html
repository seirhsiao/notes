<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Ruby 风格指南 | ——╅ 萧 ☯ ℡&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="序幕
榜样很重要。——墨菲警官《机器战警》

作为一名 Ruby 开发者，有件事一直困扰着我——Python 社区有一份优秀的编程风格参考文档（PEP-8），而我们迄今还没有一本记录 Ruby 编程风格及最佳实践的官方指南。我确信编程风格很重要，我也相信像 Ruby 这样伟大的黑客社区能够写出这本众望所归的风格指南。
这份指南原本是我司内部的 Ruby 编程指南 (在下所写的)，后来，我决定要把这">
<meta property="og:type" content="article">
<meta property="og:title" content="Ruby 风格指南">
<meta property="og:url" content="http://notes.seirhsiao.com/2016/01/26/2013-07-02-ruby-style-guide/index.html">
<meta property="og:site_name" content="——╅ 萧 ☯ ℡'s Blog">
<meta property="og:description" content="序幕
榜样很重要。——墨菲警官《机器战警》

作为一名 Ruby 开发者，有件事一直困扰着我——Python 社区有一份优秀的编程风格参考文档（PEP-8），而我们迄今还没有一本记录 Ruby 编程风格及最佳实践的官方指南。我确信编程风格很重要，我也相信像 Ruby 这样伟大的黑客社区能够写出这本众望所归的风格指南。
这份指南原本是我司内部的 Ruby 编程指南 (在下所写的)，后来，我决定要把这">
<meta property="og:image" content="http://i.creativecommons.org/l/by/3.0/88x31.png">
<meta property="og:updated_time" content="2016-01-26T12:38:51.663Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ruby 风格指南">
<meta name="twitter:description" content="序幕
榜样很重要。——墨菲警官《机器战警》

作为一名 Ruby 开发者，有件事一直困扰着我——Python 社区有一份优秀的编程风格参考文档（PEP-8），而我们迄今还没有一本记录 Ruby 编程风格及最佳实践的官方指南。我确信编程风格很重要，我也相信像 Ruby 这样伟大的黑客社区能够写出这本众望所归的风格指南。
这份指南原本是我司内部的 Ruby 编程指南 (在下所写的)，后来，我决定要把这">
  
    <link rel="alternative" href="/atom.xml" title="——╅ 萧 ☯ ℡&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">萧影随行</a></h1>
		</hgroup>

		
		<p class="header-subtitle">闻道有先后，术业有专攻！</p>
		
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">所有文章</a></li>
				        
							<li><a href="/tags/">标签云</a></li>
				        
							<li><a href="/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:309183912@qq.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="//github.com/seirhsiao" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/CSS/" style="font-size: 15.71px;">CSS</a> <a href="/tags/EndNote/" style="font-size: 10px;">EndNote</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/GIF/" style="font-size: 10px;">GIF</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitCafe/" style="font-size: 10px;">GitCafe</a> <a href="/tags/GitHub/" style="font-size: 11.43px;">GitHub</a> <a href="/tags/HTML/" style="font-size: 12.86px;">HTML</a> <a href="/tags/Hexo/" style="font-size: 15.71px;">Hexo</a> <a href="/tags/JavaScript/" style="font-size: 14.29px;">JavaScript</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/Markdown/" style="font-size: 12.86px;">Markdown</a> <a href="/tags/PNG/" style="font-size: 10px;">PNG</a> <a href="/tags/PhotoShop/" style="font-size: 10px;">PhotoShop</a> <a href="/tags/PowerPoint/" style="font-size: 10px;">PowerPoint</a> <a href="/tags/Reference/" style="font-size: 10px;">Reference</a> <a href="/tags/Software/" style="font-size: 10px;">Software</a> <a href="/tags/Table/" style="font-size: 10px;">Table</a> <a href="/tags/TagCloud/" style="font-size: 10px;">TagCloud</a> <a href="/tags/UA/" style="font-size: 10px;">UA</a> <a href="/tags/UML/" style="font-size: 11.43px;">UML</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/WordPress/" style="font-size: 10px;">WordPress</a> <a href="/tags/awk/" style="font-size: 11.43px;">awk</a> <a href="/tags/binding/" style="font-size: 10px;">binding</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/book/" style="font-size: 12.86px;">book</a> <a href="/tags/clojure/" style="font-size: 20px;">clojure</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/eclipse/" style="font-size: 12.86px;">eclipse</a> <a href="/tags/editor/" style="font-size: 10px;">editor</a> <a href="/tags/frontend/" style="font-size: 10px;">frontend</a> <a href="/tags/git/" style="font-size: 12.86px;">git</a> <a href="/tags/gitcafe/" style="font-size: 10px;">gitcafe</a> <a href="/tags/github/" style="font-size: 11.43px;">github</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/httpkit/" style="font-size: 10px;">httpkit</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/leigingen/" style="font-size: 10px;">leigingen</a> <a href="/tags/linux/" style="font-size: 14.29px;">linux</a> <a href="/tags/list/" style="font-size: 10px;">list</a> <a href="/tags/macro/" style="font-size: 10px;">macro</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/markdown/" style="font-size: 12.86px;">markdown</a> <a href="/tags/maven/" style="font-size: 12.86px;">maven</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nexus/" style="font-size: 11.43px;">nexus</a> <a href="/tags/rails/" style="font-size: 10px;">rails</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/ruby/" style="font-size: 11.43px;">ruby</a> <a href="/tags/seq/" style="font-size: 10px;">seq</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/tips/" style="font-size: 11.43px;">tips</a> <a href="/tags/tools/" style="font-size: 11.43px;">tools</a> <a href="/tags/vi/" style="font-size: 10px;">vi</a> <a href="/tags/书籍/" style="font-size: 11.43px;">书籍</a> <a href="/tags/优化/" style="font-size: 11.43px;">优化</a> <a href="/tags/入门/" style="font-size: 18.57px;">入门</a> <a href="/tags/多说/" style="font-size: 10px;">多说</a> <a href="/tags/技巧/" style="font-size: 10px;">技巧</a> <a href="/tags/指南/" style="font-size: 17.14px;">指南</a> <a href="/tags/环境搭建/" style="font-size: 12.86px;">环境搭建</a> <a href="/tags/类图/" style="font-size: 11.43px;">类图</a> <a href="/tags/翻译/" style="font-size: 15.71px;">翻译</a> <a href="/tags/语法/" style="font-size: 10px;">语法</a> <a href="/tags/资源/" style="font-size: 17.14px;">资源</a> <a href="/tags/集合/" style="font-size: 14.29px;">集合</a> <a href="/tags/风格/" style="font-size: 14.29px;">风格</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">一花一世界，一叶一追寻。一曲一场叹，一生为一人。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">萧影随行</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">萧影随行</a></h1>
			</hgroup>
			
			<p class="header-subtitle">闻道有先后，术业有专攻！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">所有文章</a></li>
		        
					<li><a href="/tags/">标签云</a></li>
		        
					<li><a href="/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:309183912@qq.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="//github.com/seirhsiao" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2013-07-02-ruby-style-guide" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/26/2013-07-02-ruby-style-guide/" class="article-date">
  	<time datetime="2016-01-26T12:38:51.663Z" itemprop="datePublished">2016-01-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Ruby 风格指南
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Guide/">Guide</a>
	</div>


        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/指南/">指南</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/翻译/">翻译</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/风格/">风格</a></li></ul>
	</div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="u5E8F_u5E55"><a href="#u5E8F_u5E55" class="headerlink" title="序幕"></a>序幕</h1><blockquote>
<p>榜样很重要。<br><br>——墨菲警官《机器战警》</p>
</blockquote>
<p>作为一名 Ruby 开发者，有件事一直困扰着我——Python 社区有一份优秀的编程风格参考文档（<a href="http://www.python.org/dev/peps/pep-0008/" target="_blank" rel="external">PEP-8</a>），而我们迄今还没有一本记录 Ruby 编程风格及最佳实践的官方指南。我确信编程风格很重要，我也相信像 Ruby 这样伟大的黑客社区能够写出这本众望所归的风格指南。</p>
<p>这份指南原本是我司内部的 Ruby 编程指南 (在下所写的)，后来，我决定要把这一成果贡献给广大的 Ruby 社区。这个世界再多一份公司内部文件并没有什么不同，然而，由社区推动并制定的一系列 Ruby 编程惯例、最佳实践及代码风格，却能让全世界的 Ruby 开发者都从中获益。</p>
<p>从编写这份指南开始，我收到了很多 Ruby 社区成员的反馈。感谢所有的建议及支持！只要同心协力，我们就能创造一个让每个 Ruby 开发者都从中受益的资源。</p>
<p>顺道一提，如果你对 Rails 感兴趣，你可以看看这份 <a href="https://github.com/bbatsov/rails-style-guide" target="_blank" rel="external">Ruby on Rails 风格指南</a> 作为补充。</p>
<h1 id="Ruby__u98CE_u683C_u6307_u5357"><a href="#Ruby__u98CE_u683C_u6307_u5357" class="headerlink" title="Ruby 风格指南"></a>Ruby 风格指南</h1><p>这份 Ruby 风格指南推荐的是 Ruby 的最佳实践，现实世界中的 Ruby 程序员据此可以写出可维护的高质量代码。我们只说实际使用中的用法。指南再好，但里面说的过于理想化结果大家拒绝使用或者可能根本没人用，又有何意义。</p>
<p>本指南分为几个小节，每一小节由几条相关的规则构成。我尽力在每条规则后面说明理由（如果省略了说明，那是因为其理由显而易见）。</p>
<p>这些规则不是我凭空想象出来的——它们中的绝大部分来自我多年以来作为职业软件工程师的经验，来自 Ruby 社区成员的反馈和建议，以及几个评价甚高的 Ruby 编程资源，像 <a href="http://pragprog.com/book/ruby4/programming-ruby-1-9-2-0" target="_blank" rel="external">《Programming Ruby 1.9》</a> 以及 <a href="http://www.amazon.com/Ruby-Programming-Language-David-Flanagan/dp/0596516177" target="_blank" rel="external">《The Ruby Programming Language》</a>。</p>
<p>Ruby 社区尚未就某些规则达成明显的共识，例如字符串字面量的引号、hash 字面量两端是否应该有空格、多行方法链式调用中点运算符的位置。对于这种情况，本指南列出了所有可选的流行风格，你可以任选其一并坚持使用。</p>
<p>本指南会一直更新，随着 Ruby 本身的发展，新的规则会添加进来，过时的规则会被剔除。</p>
<p>许多项目有其自己的编码风格指南（往往是源于本指南而创建）。当项目的风格指南与本指南发生冲突时，应以项目级的指南为准。</p>
<p>你可以使用 <a href="https://github.com/TechnoGate/transmuter" target="_blank" rel="external">Transmuter</a> 生成本指南的 PDF 或 HTML 版本。</p>
<p><a href="https://github.com/bbatsov/rubocop" target="_blank" rel="external">RuboCop</a> 项目会自动检查你的 Ruby 代码是否符合这份 Ruby 风格指南。</p>
<p>本指南有以下翻译版本：</p>
<ul>
<li><a href="https://github.com/JuanitoFatas/ruby-style-guide/blob/master/README-zhCN.md" target="_blank" rel="external">简体中文</a></li>
<li><a href="https://github.com/JuanitoFatas/ruby-style-guide/blob/master/README-zhTW.md" target="_blank" rel="external">繁體中文</a></li>
<li><a href="https://github.com/porecreat/ruby-style-guide/blob/master/README-frFR.md" target="_blank" rel="external">法文</a></li>
<li><a href="https://github.com/arbox/de-ruby-style-guide/blob/master/README-deDE.md" target="_blank" rel="external">德文</a></li>
<li><a href="https://github.com/fortissimo1997/ruby-style-guide/blob/japanese/README.ja.md" target="_blank" rel="external">日文</a></li>
<li><a href="https://github.com/dalzony/ruby-style-guide/blob/master/README-koKR.md" target="_blank" rel="external">韩文</a></li>
<li><a href="https://github.com/rubensmabueno/ruby-style-guide/blob/master/README-PT-BR.md" target="_blank" rel="external">葡萄牙文</a></li>
<li><a href="https://github.com/arbox/ruby-style-guide/blob/master/README-ruRU.md" target="_blank" rel="external">俄文</a></li>
<li><a href="https://github.com/alemohamad/ruby-style-guide/blob/master/README-esLA.md" target="_blank" rel="external">西班牙文</a></li>
<li><a href="https://github.com/scrum2b/ruby-style-guide/blob/master/README-viVN.md" target="_blank" rel="external">越南文</a></li>
</ul>
<h2 id="u76EE_u5F55"><a href="#u76EE_u5F55" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="/#源代码排版">源代码排版</a></li>
<li><a href="/#语法">语法</a></li>
<li><a href="/#命名">命名</a></li>
<li><a href="/#注释">注释</a><ul>
<li><a href="/#注解">注解</a></li>
</ul>
</li>
<li><a href="/#类与模块">类与模块</a></li>
<li><a href="/#异常">异常</a></li>
<li><a href="/#集合">集合</a></li>
<li><a href="/#字符串">字符串</a></li>
<li><a href="/#正则表达式">正则表达式</a></li>
<li><a href="/#百分号字面量">百分号字面量</a></li>
<li><a href="/#元编程">元编程</a></li>
<li><a href="/#其它">其它</a></li>
<li><a href="/#工具">工具</a><a id="more"></a>
<h2 id="u6E90_u4EE3_u7801_u6392_u7248"><a href="#u6E90_u4EE3_u7801_u6392_u7248" class="headerlink" title="源代码排版"></a>源代码排版</h2></li>
</ul>
<blockquote>
<p>所有风格都又丑又难读，自己的除外。几乎人人都这样想。把“自己的除外”拿掉，他们或许是对的…<br><br>——Jerry Coffin（论缩排）</p>
</blockquote>
<ul>
<li>使用 <code>UTF-8</code> 作为源文件的编码。</li>
<li><p>每个缩排层级使用两个<strong>空格</strong>。不要使用硬 tab。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 四个空格</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">    do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 Unix 风格的换行符。（BSD/Solaris/Linux/OSX 的用户不用担心，Windows 用户要格外小心。）</p>
<ul>
<li><p>如果你使用 Git ，可用下面这个配置，来保护你的项目不被 Windows 的换行符干扰：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>不要使用 <code>;</code> 分隔语句或表达式。推论——每个表达式应独占一行。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">puts <span class="string">'foobar'</span>; <span class="comment"># 不必要的分号</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">'foo'</span>; puts <span class="string">'bar'</span> <span class="comment"># 一行里有两个表达式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">puts <span class="string">'foobar'</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">'foo'</span></span><br><span class="line">puts <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">'foo'</span>, <span class="string">'bar'</span> <span class="comment"># 仅对 puts 适用</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>没有内容的类定义语句，应优先采用单行格式。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> <span class="inheritance">&lt; <span class="parent">StandardError</span></span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 勉强可以</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> <span class="inheritance">&lt; <span class="parent">StandardError</span></span>;</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">FooError</span> = <span class="constant">Class</span>.new(<span class="constant">StandardError</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义方法时应避免单行写法。尽管有些人喜欢这么用，但是单行定义的语法有些古怪，应此绝不是一个好的实践。无论如何——一个单行方法里的表达式不应该多于 1 个。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">too_much</span>;</span> something; something_else; <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 勉强可以——注意第一个 ; 是必需的</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_braces_method</span>;</span> body <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 勉强可以——注意第二个 ; 是可选的</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_braces_method</span>;</span> body; <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 勉强可以——语法上正确，但是没有 ; 让它有些难读</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">()</span> <span class="title">body</span> <span class="title">end</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  body</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  这个规则的一个例外是空方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_op</span>;</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>操作符前后应添加空格：在逗号 <code>,</code> 、冒号 <code>:</code> 及分号 <code>;</code> 之后，在 <code>{</code> 前后，在 <code>}</code> 之前。<br>一般情况下，Ruby 解释器会忽略空格。但要写出可读性高的代码，合理使用空格是关键。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sum = <span class="number">1</span> + <span class="number">2</span></span><br><span class="line">a, b = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each &#123; |e| puts e &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> <span class="inheritance">&lt; <span class="parent">StandardError</span></span>;</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  （针对操作符）唯一的例外是使用指数操作符时：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">e = <span class="constant">M</span> * c ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">e = <span class="constant">M</span> * c**<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>  <code>{</code> 和 <code>}</code> 需要额外说明，因为他们可以用在块（block）、<br>  哈希字面量（hash literals）以及字符串插值中。<br>  对于哈希字面量来说，以下两种风格都是可接受的：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 好——`&#123;` 之后和 `&#125;` 之前有空格</span></span><br><span class="line">&#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好——`&#123;` 之后和 `&#125;` 之前没有空格</span></span><br><span class="line">&#123;<span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>
<p>  第一种风格可读性更好一些（而且无疑在 Ruby 社区更受欢迎）,<br>  第二种风格的优点是可以在视觉上区分块和哈希字面量。<br>  无论你选哪一种，重要的是保持一致。</p>
</li>
</ul>
<ul>
<li><p><code>(</code> 、 <code>[</code> 之后， <code>]</code> 、 <code>)</code> 之前，不要有空格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">some( arg ).other</span><br><span class="line">[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ].size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">some(arg).other</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].size</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>!</code> 后面不要有空格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">! something</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">!something</span><br></pre></td></tr></table></figure>
</li>
<li><p>范围字面量中间不要有空格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="number">1</span> .. <span class="number">3</span></span><br><span class="line"><span class="string">'a'</span> ... <span class="string">'z'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="number">1</span>..<span class="number">3</span></span><br><span class="line"><span class="string">'a'</span>...<span class="string">'z'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把 <code>when</code> 跟 <code>case</code> 缩排在同一层。这是《The Ruby Programming Language》及《Programming Ruby》所使用的风格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">case</span></span><br><span class="line">  <span class="keyword">when</span> song.name == <span class="string">'Misty'</span></span><br><span class="line">    puts <span class="string">'Not again!'</span></span><br><span class="line">  <span class="keyword">when</span> song.duration &gt; <span class="number">120</span></span><br><span class="line">    puts <span class="string">'Too long!'</span></span><br><span class="line">  <span class="keyword">when</span> <span class="constant">Time</span>.now.hour &gt; <span class="number">21</span></span><br><span class="line">    puts <span class="string">"It's too late"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    song.play</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">case</span></span><br><span class="line"><span class="keyword">when</span> song.name == <span class="string">'Misty'</span></span><br><span class="line">  puts <span class="string">'Not again!'</span></span><br><span class="line"><span class="keyword">when</span> song.duration &gt; <span class="number">120</span></span><br><span class="line">  puts <span class="string">'Too long!'</span></span><br><span class="line"><span class="keyword">when</span> <span class="constant">Time</span>.now.hour &gt; <span class="number">21</span></span><br><span class="line">  puts <span class="string">"It's too late"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  song.play</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把一个条件表达式的结果赋给变量时，应保持条件表达式的缩进层级。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 非常复杂</span></span><br><span class="line">kind = <span class="keyword">case</span> year</span><br><span class="line"><span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">'Jazz'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">result = <span class="keyword">if</span> some_cond</span><br><span class="line">  calc_something</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  calc_something_else</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 - 结构很清晰</span></span><br><span class="line">kind = <span class="keyword">case</span> year</span><br><span class="line">       <span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></span><br><span class="line">       <span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></span><br><span class="line">       <span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></span><br><span class="line">       <span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></span><br><span class="line">       <span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></span><br><span class="line">       <span class="keyword">else</span> <span class="string">'Jazz'</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">result = <span class="keyword">if</span> some_cond</span><br><span class="line">           calc_something</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">           calc_something_else</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 ( 避免代码让行宽过长 )</span></span><br><span class="line">kind =</span><br><span class="line">  <span class="keyword">case</span> year</span><br><span class="line">  <span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></span><br><span class="line">  <span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></span><br><span class="line">  <span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></span><br><span class="line">  <span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></span><br><span class="line">  <span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></span><br><span class="line">  <span class="keyword">else</span> <span class="string">'Jazz'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">result =</span><br><span class="line">  <span class="keyword">if</span> some_cond</span><br><span class="line">    calc_something</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    calc_something_else</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>def</code> 之间使用空行，并且用空行把方法分成合乎逻辑的段落。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  data = initialize(options)</span><br><span class="line"></span><br><span class="line">  data.manipulate!</span><br><span class="line"></span><br><span class="line">  data.result</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  result</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用方法时最后一个参数后面不要加逗号，特别是参数都在同一行的时候。</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 虽然移动和增删参数的时候会很简单，但仍不推荐</span></span><br><span class="line">some_method(</span><br><span class="line">             size,</span><br><span class="line">             count,</span><br><span class="line">             color,</span><br><span class="line">           )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">some_method(size, count, color, )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">some_method(size, count, color)</span><br></pre></td></tr></table></figure>
</li>
<li><p>当给方法的参数赋默认值时，在 <code>=</code> 两边使用空格：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(arg1=<span class="symbol">:default</span>, arg2=<span class="keyword">nil</span>, arg3=[])</span></span></span><br><span class="line">  <span class="comment"># 做一些任务...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(arg1 = <span class="symbol">:default</span>, arg2 = <span class="keyword">nil</span>, arg3 = [])</span></span></span><br><span class="line">  <span class="comment"># 做一些任务...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  虽然几本 Ruby 书建议用第一个风格，不过第二个风格在实践中更为常见（而且可读性无疑更高一些）。</p>
</li>
<li><p>避免在不必要的时候使用续行符 <code>\</code> 。实际编码时，除了字符串拼接, 应避免在任何情况下使用续行符。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">result = <span class="number">1</span> - \</span><br><span class="line">         <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 (但是仍然丑到爆)</span></span><br><span class="line">result = <span class="number">1</span> \</span><br><span class="line">         - <span class="number">2</span></span><br><span class="line"></span><br><span class="line">long_string = <span class="string">'First part of the long string'</span> \</span><br><span class="line">              <span class="string">' and second part of the long string'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用链式方法调用时风格应保持一致。Ruby 社区认为前引点号和末端点号都是好的风格。</p>
<ul>
<li><p>（可选风格 A）当一个链式方法调用需要在另一行继续时，将 <code>.</code> 放在第二行。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 为了理解第二行需要去查阅第一行</span></span><br><span class="line">one.two.three.</span><br><span class="line">  four</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 好 - 第二行在做什么立刻变得很清晰</span></span><br><span class="line">one.two.three</span><br><span class="line">  .four</span><br></pre></td></tr></table></figure>
</li>
<li><p>（可选风格 B）首行末尾用点号表示表达式还未结束</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 需要读到第二行才能确定表达式没有结束</span></span><br><span class="line">one.two.three</span><br><span class="line">  .four</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 好 - 从第一行就可以立即明白表达式没有结束</span></span><br><span class="line">one.two.three.</span><br><span class="line">  four</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>关于两种方法各自优点的讨论，可以参阅<a href="https://github.com/bbatsov/ruby-style-guide/pull/176" target="_blank" rel="external">这里</a>。</p>
</li>
<li><p>方法参数过长时，将它对齐排列在多行。当对齐的参数由于线宽不适合对齐时, 简单的在第一行之后缩进也是可以接受的。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始（行太长了）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></span><br><span class="line">  <span class="constant">Mailer</span>.deliver(<span class="symbol">to:</span> <span class="string">'bob@example.com'</span>, <span class="symbol">from:</span> <span class="string">'us@example.com'</span>, <span class="symbol">subject:</span> <span class="string">'Important message'</span>, <span class="symbol">body:</span> source.text)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差（两倍缩排）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></span><br><span class="line">  <span class="constant">Mailer</span>.deliver(</span><br><span class="line">      <span class="symbol">to:</span> <span class="string">'bob@example.com'</span>,</span><br><span class="line">      <span class="symbol">from:</span> <span class="string">'us@example.com'</span>,</span><br><span class="line">      <span class="symbol">subject:</span> <span class="string">'Important message'</span>,</span><br><span class="line">      <span class="symbol">body:</span> source.text)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></span><br><span class="line">  <span class="constant">Mailer</span>.deliver(<span class="symbol">to:</span> <span class="string">'bob@example.com'</span>,</span><br><span class="line">                 <span class="symbol">from:</span> <span class="string">'us@example.com'</span>,</span><br><span class="line">                 <span class="symbol">subject:</span> <span class="string">'Important message'</span>,</span><br><span class="line">                 <span class="symbol">body:</span> source.text)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好（普通缩排）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></span><br><span class="line">  <span class="constant">Mailer</span>.deliver(</span><br><span class="line">    <span class="symbol">to:</span> <span class="string">'bob@example.com'</span>,</span><br><span class="line">    <span class="symbol">from:</span> <span class="string">'us@example.com'</span>,</span><br><span class="line">    <span class="symbol">subject:</span> <span class="string">'Important message'</span>,</span><br><span class="line">    <span class="symbol">body:</span> source.text)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>跨行的数组字面量，应按项对齐。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 未对齐</span></span><br><span class="line">menu_item = [<span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>,</span><br><span class="line">  <span class="string">'Baked beans'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">menu_item = [</span><br><span class="line">  <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>,</span><br><span class="line">  <span class="string">'Baked beans'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">menu_item =</span><br><span class="line">  [<span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>,</span><br><span class="line">   <span class="string">'Baked beans'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>应该为大数添加下划线，以增强可读性。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 有几个零？</span></span><br><span class="line">num = <span class="number">1000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 - 更容易被人脑解析。</span></span><br><span class="line">num = <span class="number">1_000_000</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 RDoc 及其惯例来撰写 API 文档。不要用空行分隔注解区块及 <code>def</code>语句。</p>
</li>
<li><p>每一行限制在 80 个字符内。</p>
</li>
<li><p>避免行尾出现多余空格。</p>
</li>
<li><p>文件应以空白行结尾。</p>
</li>
<li><p>不要使用区块注释。它们不能由空白引导（<code>=begin</code> 必须顶头开始），并且不如普通注释容易辨认。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="comment">=begin</span><br><span class="line">一行注释</span><br><span class="line">另一行注释</span><br><span class="line">=end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="comment"># 一行注释</span></span><br><span class="line"><span class="comment"># 另一行注释</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u8BED_u6CD5"><a href="#u8BED_u6CD5" class="headerlink" title="语法"></a>语法</h2><ul>
<li><p><code>::</code> 应该只用来引用常量（包括类和模块）和构造器 (比如 <code>Array()</code> 或者 <code>Nokogiri::HTML()</code>)。永远不要使用 <code>::</code> 来调用常规方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">SomeClass::</span>some_method</span><br><span class="line"><span class="symbol">some_object:</span><span class="symbol">:some_method</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">SomeClass</span>.some_method</span><br><span class="line">some_object.some_method</span><br><span class="line"><span class="constant">SomeModule::SomeClass::SOME_CONST</span></span><br><span class="line"><span class="constant">SomeModule::SomeClass</span>()</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>def</code> 定义方法时，有参数时应该使用括号。当方法不接受参数时，省略括号。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">()</span></span></span><br><span class="line">  <span class="comment"># 此处省略方法体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  <span class="comment"># 此处省略方法体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method_with_parameters</span> <span class="title">param1</span>, <span class="title">param2</span></span></span><br><span class="line">  <span class="comment"># 此处省略方法体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method_with_parameters</span><span class="params">(param1, param2)</span></span></span><br><span class="line">  <span class="comment"># 此处省略方法体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>定义参数默认值时候，有默认值的参数应该在参数列表的后面。如果有默认值的参数应该在参数列表的前面，Ruby调用时会发生不可预料的结果。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bad</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(a = <span class="number">1</span>, b = <span class="number">2</span>, c, d)</span></span></span><br><span class="line">puts <span class="string">"<span class="subst">#&#123;a&#125;</span>, <span class="subst">#&#123;b&#125;</span>, <span class="subst">#&#123;c&#125;</span>, <span class="subst">#&#123;d&#125;</span>"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>) <span class="comment"># =&gt; '1, 2, w, x'</span></span><br><span class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>) <span class="comment"># =&gt; 'w, 2, x, y'</span></span><br><span class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>) <span class="comment"># =&gt; 'w, x, y, z'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># good</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(a, b, c = <span class="number">1</span>, d = <span class="number">2</span>)</span></span></span><br><span class="line">  puts <span class="string">"<span class="subst">#&#123;a&#125;</span>, <span class="subst">#&#123;b&#125;</span>, <span class="subst">#&#123;c&#125;</span>, <span class="subst">#&#123;d&#125;</span>"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>) <span class="comment"># =&gt; 'w, x, 1, 2'</span></span><br><span class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>) <span class="comment"># =&gt; 'w, x, y, 2'</span></span><br><span class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>) <span class="comment"># =&gt; 'w, x, y, z'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用并行赋值来初始化变量。当使用方法返回值，变量带星号，交换赋值时，可以使用并行赋值。给每个变量单独赋值比并行赋值可读性更高。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bad</span></span><br><span class="line">a, b, c, d = <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>, <span class="string">'foobar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># good</span></span><br><span class="line">a = <span class="string">'foo'</span></span><br><span class="line">b = <span class="string">'bar'</span></span><br><span class="line">c = <span class="string">'baz'</span></span><br><span class="line">d = <span class="string">'foobar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># good - swapping variable assignment</span></span><br><span class="line"><span class="comment"># Swapping variable assignment is a special case because it will allow you to</span></span><br><span class="line"><span class="comment"># swap the values that are assigned to each variable.</span></span><br><span class="line">a = <span class="string">'foo'</span></span><br><span class="line">b = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">a, b = b, a</span><br><span class="line">puts a <span class="comment"># =&gt; 'bar'</span></span><br><span class="line">puts b <span class="comment"># =&gt; 'foo'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># good - method return</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_return</span></span></span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">first, second = multi_return</span><br><span class="line"></span><br><span class="line"><span class="comment"># good - 带`*`其实就是把变量当成数组</span></span><br><span class="line">first, *list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">hello_array = *<span class="string">"Hello"</span></span><br><span class="line"></span><br><span class="line">a = *(<span class="number">1</span>..<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>并行赋值时避免在最右边使用不必要的下划线变量。当左边的变量带<code>*</code>时才使用下划线变量。避免<code>*_</code>这个用法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bad</span></span><br><span class="line">a, b, <span class="number">_</span> = *foo</span><br><span class="line">a, <span class="number">_</span>, <span class="number">_</span> = *foo</span><br><span class="line">a, *<span class="number">_</span> = *foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># good</span></span><br><span class="line">*a, <span class="number">_</span> = *foo</span><br><span class="line">*a, b, <span class="number">_</span> = *foo</span><br><span class="line">a, = *foo</span><br><span class="line">a, b, = *foo</span><br><span class="line">a, _b = *foo</span><br><span class="line">a, _b, = *foo</span><br></pre></td></tr></table></figure>
</li>
<li><p>永远不要使用 <code>for</code> ，除非你很清楚为什么。大部分情况应该使用迭代器。<code>for</code> 是由 <code>each</code> 实现的，所以你绕弯了。另外，<code>for</code> 没有包含一个新的作用域 (<code>each</code> 有），因此在它区块中定义的变量在外部是可见的。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> arr <span class="keyword">do</span></span><br><span class="line">  puts elem</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意 elem 可在 for 循环外部被访问</span></span><br><span class="line">elem <span class="comment">#=&gt; 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">arr.each &#123; |elem| puts elem &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># elem 不能够在 each 块外部被访问</span></span><br><span class="line">elem <span class="comment">#=&gt; NameError: undefined local variable or method `elem'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>永远不要在多行的 <code>if/unless</code> 中使用 <code>then</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span> some_condition <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> some_condition</span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>总是在多行的 <code>if/unless</code> 中把条件语句放在同一行。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span></span><br><span class="line">  some_condition</span><br><span class="line">  do_something</span><br><span class="line">  do_something_else</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> some_condition</span><br><span class="line">  do_something</span><br><span class="line">  do_something_else</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>三元操作符 <code>? :</code> 比 <code>if/then/else/end</code> 结构更常见也更简洁。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">result = <span class="keyword">if</span> some_condition <span class="keyword">then</span> something <span class="keyword">else</span> something_else <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">result = some_condition ? something <span class="symbol">:</span> something_else</span><br></pre></td></tr></table></figure>
</li>
<li><p>三元操作符的每个分支只写一个表达式。即不要嵌套三元操作符。嵌套情况应使用 <code>if/else</code> 结构。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">some_condition ? (nested_condition ? nested_something <span class="symbol">:</span> nested_something_else) <span class="symbol">:</span> something_else</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> some_condition</span><br><span class="line">  nested_condition ? nested_something <span class="symbol">:</span> nested_something_else</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  something_else</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>永远不要使用 <code>if x; ...</code>——使用三元操作符。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">result = <span class="keyword">if</span> <span class="symbol">some_condition:</span> something <span class="keyword">else</span> something_else <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">result = some_condition ? something <span class="symbol">:</span> something_else</span><br></pre></td></tr></table></figure>
</li>
<li><p>充分利用 if 和 case 是表达式的特性，它们有返回值。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span> condition</span><br><span class="line">  result = x</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  result = y</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">result =</span><br><span class="line">  <span class="keyword">if</span> condition</span><br><span class="line">    x</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    y</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>单行情况使用 <code>when x then ...</code>。另一种语法 <code>when x: ...</code> 已经在 Ruby 1.9 被移除了。</p>
</li>
<li><p>永远不要使用 <code>when x; ...</code>。参考前一个规则。</p>
</li>
<li><p>使用 <code>!</code> 替代 <code>not</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 因为操作符有优先级，需要用括号。</span></span><br><span class="line">x = (<span class="keyword">not</span> something)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">x = !something</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用 <code>!!</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">x = <span class="string">'test'</span></span><br><span class="line"><span class="comment"># 令人疑惑的空值检查</span></span><br><span class="line"><span class="keyword">if</span> !!x</span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">x = <span class="keyword">false</span></span><br><span class="line"><span class="comment"># 对布尔值进行双重否定是不必要的</span></span><br><span class="line">!!x <span class="comment"># =&gt; false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">x = <span class="string">'test'</span></span><br><span class="line"><span class="keyword">unless</span> x.<span class="keyword">nil</span>?</span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>绝不要使用 <code>and</code> 和 <code>or</code> 这两个关键字，总是使用 <code>&amp;&amp;</code> 和 <code>||</code> 来替代它们。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="comment"># 布尔表达式</span></span><br><span class="line"><span class="keyword">if</span> some_condition <span class="keyword">and</span> some_other_condition</span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制流程</span></span><br><span class="line">document.saved? <span class="keyword">or</span> document.save!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="comment"># 布尔表达式</span></span><br><span class="line"><span class="keyword">if</span> some_condition &amp;&amp; some_other_condition</span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制流程</span></span><br><span class="line">document.saved? || document.save!</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免多行的 <code>? :</code>（三元操作符）；使用 <code>if/unless</code> 来取代。</p>
</li>
<li><p>单行主体用 <code>if/unless</code> 修饰符。另一个好的方法是使用 <code>&amp;&amp;/||</code> 控制流程。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span> some_condition</span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">if</span> some_condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 另一个好方法</span></span><br><span class="line">some_condition &amp;&amp; do_something</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免在多行区块后使用 <code>if</code> 或 <code>unless</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="number">10</span>.times <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># 此处省略多行语句体</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span> some_condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> some_condition</span><br><span class="line">  <span class="number">10</span>.times <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 此处省略多行语句体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>否定判断时，<code>unless</code>（或控制流程的 <code>||</code>）优于 <code>if</code>（或使用 <code>||</code> 控制流程）。</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">do_something <span class="keyword">if</span> !some_condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">do_something <span class="keyword">if</span> <span class="keyword">not</span> some_condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">unless</span> some_condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 另一个好方法</span></span><br><span class="line">some_condition || do_something</span><br></pre></td></tr></table></figure>
</li>
<li><p>永远不要使用 <code>unless</code> 和 <code>else</code> 组合。改写成肯定条件。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">unless</span> success?</span><br><span class="line">  puts <span class="string">'failure'</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">'success'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> success?</span><br><span class="line">  puts <span class="string">'success'</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">'failure'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要使用括号围绕 <code>if/unless/while</code> 的条件表达式。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">10</span>)</span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> x &gt; <span class="number">10</span></span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在多行 <code>while/until</code> 中不要使用 <code>while/until condition do</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">while</span> x &gt; <span class="number">5</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">until</span> x &gt; <span class="number">5</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">while</span> x &gt; <span class="number">5</span></span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">until</span> x &gt; <span class="number">5</span></span><br><span class="line">  <span class="comment"># 此处省略语句体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>单行主体时尽量使用 <code>while/until</code> 修饰符。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">while</span> some_condition</span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">while</span> some_condition</span><br></pre></td></tr></table></figure>
</li>
<li><p>否定条件判断尽量使用 <code>until</code> 而不是 <code>while</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">do_something <span class="keyword">while</span> !some_condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">until</span> some_condition</span><br></pre></td></tr></table></figure>
</li>
<li><p>无限循环用 <code>Kernel#loop</code>，不用 <code>while/until</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">true</span></span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">until</span> <span class="keyword">false</span></span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">loop <span class="keyword">do</span></span><br><span class="line">  do_something</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>循环后条件判断使用 <code>Kernel#loop</code> 和 <code>break</code>，而不是 <code>begin/end/until</code> 或者 <code>begin/end/while</code>。</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  puts val</span><br><span class="line">  val += <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span> val &lt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">loop <span class="keyword">do</span></span><br><span class="line">  puts val</span><br><span class="line">  val += <span class="number">1</span></span><br><span class="line">  <span class="keyword">break</span> <span class="keyword">unless</span> val &lt; <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>忽略围绕方法参数的括号，如内部 DSL (如：Rake, Rails, RSpec)，Ruby 中带有“关键字”状态的方法（如：<code>attr_reader</code>，<code>puts</code>）以及属性存取方法。所有其它的方法调用使用括号围绕参数。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:name</span>, <span class="symbol">:age</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 忽略</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">temperance = <span class="constant">Person</span>.new(<span class="string">'Temperance'</span>, <span class="number">30</span>)</span><br><span class="line">temperance.name</span><br><span class="line"></span><br><span class="line">puts temperance.age</span><br><span class="line"></span><br><span class="line">x = <span class="constant">Math</span>.sin(y)</span><br><span class="line">array.delete(e)</span><br><span class="line"></span><br><span class="line">bowling.score.should == <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当哈希作为可选参数使用时，省略该哈希的外部花括号。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">user.set(&#123; <span class="symbol">name:</span> <span class="string">'John'</span>, <span class="symbol">age:</span> <span class="number">45</span>, <span class="symbol">permissions:</span> &#123; <span class="symbol">read:</span> <span class="keyword">true</span> &#125; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">User</span>.set(<span class="symbol">name:</span> <span class="string">'John'</span>, <span class="symbol">age:</span> <span class="number">45</span>, <span class="symbol">permissions:</span> &#123; <span class="symbol">read:</span> <span class="keyword">true</span> &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果方法是内部 DSL 的一部分，那么省略外层的花括号和圆括号。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="comment"># 差</span></span><br><span class="line">  validates(<span class="symbol">:name</span>, &#123; <span class="symbol">presence:</span> <span class="keyword">true</span>, <span class="symbol">length:</span> &#123; <span class="symbol">within:</span> <span class="number">1</span>..<span class="number">10</span> &#125; &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 好</span></span><br><span class="line">  validates <span class="symbol">:name</span>, <span class="symbol">presence:</span> <span class="keyword">true</span>, <span class="symbol">length:</span> &#123; <span class="symbol">within:</span> <span class="number">1</span>..<span class="number">10</span> &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果方法调用不需要参数，那么省略圆括号。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">Kernel</span>.exit!()</span><br><span class="line"><span class="number">2</span>.even?()</span><br><span class="line">fork()</span><br><span class="line"><span class="string">'test'</span>.upcase()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">Kernel</span>.exit!</span><br><span class="line"><span class="number">2</span>.even?</span><br><span class="line">fork</span><br><span class="line"><span class="string">'test'</span>.upcase</span><br></pre></td></tr></table></figure>
</li>
<li><p>当被调用的方法是只有一个操作的块时，使用更简短的 <code>proc</code> 调用。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">names.map &#123; |name| name.upcase &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">names.map(&amp;<span class="symbol">:upcase</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>单行块倾向使用 <code>{...}</code> 而不是 <code>do...end</code>。多行块避免使用 <code>{...}</code>（多行链式调用总是更丑陋）。在 <code>do...end</code> 、 “控制流程”及“方法定义”，永远使用 <code>do...end</code> （如 Rakefile 及某些 DSL）。方法链式调用时避免使用 <code>do...end</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">names = <span class="string">%w(Bozhidar Steve Sarah)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">names.each <span class="keyword">do</span> |name|</span><br><span class="line">  puts name</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">names.each &#123; |name| puts name &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">names.select <span class="keyword">do</span> |name|</span><br><span class="line">  name.start_with?(<span class="string">'S'</span>)</span><br><span class="line"><span class="keyword">end</span>.map &#123; |name| name.upcase &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">names.select &#123; |name| name.start_with?(<span class="string">'S'</span>) &#125;.map(&amp;<span class="symbol">:upcase</span>)</span><br></pre></td></tr></table></figure>
<p>  某些人会争论多行串连时，使用 <code>{...}</code> 看起来还可以，但他们应该扪心自问——这样代码真的可读吗？难道不能把区块内容取出来放到小巧的方法里吗？</p>
</li>
<li><p>显性使用区块参数而不是用创建区块字面量的方式传递参数给区块。此规则对性能有所影响，因为区块先被转化为 <code>Proc</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'tempfile'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_tmp_dir</span></span></span><br><span class="line">  <span class="constant">Dir</span>.mktmpdir <span class="keyword">do</span> |tmp_dir|</span><br><span class="line">    <span class="constant">Dir</span>.chdir(tmp_dir) &#123; |dir| <span class="keyword">yield</span> dir &#125;  <span class="comment"># block just passes arguments</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_tmp_dir</span><span class="params">(&amp;block)</span></span></span><br><span class="line">  <span class="constant">Dir</span>.mktmpdir <span class="keyword">do</span> |tmp_dir|</span><br><span class="line">    <span class="constant">Dir</span>.chdir(tmp_dir, &amp;block)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">with_tmp_dir <span class="keyword">do</span> |dir| <span class="comment"># 使用上面的方法</span></span><br><span class="line">  puts <span class="string">"dir is accessible as a parameter and pwd is set: <span class="subst">#&#123;dir&#125;</span>"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免在不需要控制流程的场合时使用 <code>return</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(some_arr)</span></span></span><br><span class="line">  <span class="keyword">return</span> some_arr.size</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(some_arr)</span></span></span><br><span class="line">  some_arr.size</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免在不需要的情况使用 <code>self</code> 。（只有在调用一个 self write 访问器时会需要用到。）</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ready?</span></span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">self</span>.last_reviewed_at &gt; <span class="keyword">self</span>.last_updated_at</span><br><span class="line">    <span class="keyword">self</span>.worker.update(<span class="keyword">self</span>.content, <span class="keyword">self</span>.options)</span><br><span class="line">    <span class="keyword">self</span>.status = <span class="symbol">:in_progress</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">self</span>.status == <span class="symbol">:verified</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ready?</span></span></span><br><span class="line">  <span class="keyword">if</span> last_reviewed_at &gt; last_updated_at</span><br><span class="line">    worker.update(content, options)</span><br><span class="line">    <span class="keyword">self</span>.status = <span class="symbol">:in_progress</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  status == <span class="symbol">:verified</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免局部变量遮蔽方法调用，除非它们有相同的效果。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:options</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 勉强可以</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(options)</span></span></span><br><span class="line">    <span class="keyword">self</span>.options = options</span><br><span class="line">    <span class="comment"># 此处 options 和 self.options 都是等价的</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 差</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(options = &#123;&#125;)</span></span></span><br><span class="line">    <span class="keyword">unless</span> options[<span class="symbol">:when</span>] == <span class="symbol">:later</span></span><br><span class="line">      output(<span class="keyword">self</span>.options[<span class="symbol">:message</span>])</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 好</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(params = &#123;&#125;)</span></span></span><br><span class="line">    <span class="keyword">unless</span> params[<span class="symbol">:when</span>] == <span class="symbol">:later</span></span><br><span class="line">      output(options[<span class="symbol">:message</span>])</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要在条件表达式里使用 <code>=</code> （赋值）的返回值，除非条件表达式在圆括号内被赋值。这是一个相当流行的 Ruby 惯用技巧，有时被称为<em>safe assignment in condition</em>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 (会触发一个警告提示)</span></span><br><span class="line"><span class="keyword">if</span> v = array.grep(<span class="regexp">/foo/</span>)</span><br><span class="line">  do_something(v)</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 (MRI 仍会抱怨, 但 RuboCop 不会)</span></span><br><span class="line"><span class="keyword">if</span> (v = array.grep(<span class="regexp">/foo/</span>))</span><br><span class="line">  do_something(v)</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">v = array.grep(<span class="regexp">/foo/</span>)</span><br><span class="line"><span class="keyword">if</span> v</span><br><span class="line">  do_something(v)</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>变量自赋值用简写方式。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">x = x + y</span><br><span class="line">x = x * y</span><br><span class="line">x = x**y</span><br><span class="line">x = x / y</span><br><span class="line">x = x || y</span><br><span class="line">x = x &amp;&amp; y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">x += y</span><br><span class="line">x *= y</span><br><span class="line">x **= y</span><br><span class="line">x /= y</span><br><span class="line">x ||= y</span><br><span class="line">x &amp;&amp;= y</span><br></pre></td></tr></table></figure>
</li>
<li><p>只有当变量未初始化时，才用 <code>||=</code> 来初始化变量并为它赋值。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">name = name ? name <span class="symbol">:</span> <span class="string">'Bozhidar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">name = <span class="string">'Bozhidar'</span> <span class="keyword">unless</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 仅在 name 为 nil 或 false 时，把名字设为 Bozhidar。</span></span><br><span class="line">name ||= <span class="string">'Bozhidar'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要使用 <code>||=</code> 来初始化布尔变量。 （想看看如果现在的值刚好是 <code>false</code> 时会发生什么。）</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差——会把 `enabled` 设成真，即便它本来是假。</span></span><br><span class="line">enabled ||= <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">enabled = <span class="keyword">true</span> <span class="keyword">if</span> enabled.<span class="keyword">nil</span>?</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 &amp;&amp;= 可先检查是否存在变量，如果存在则做相应动作。这样就无需用 <code>if</code> 检查变量是否存在了。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span> something</span><br><span class="line">  something = something.downcase</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">something = something ? something.downcase <span class="symbol">:</span> <span class="keyword">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以</span></span><br><span class="line">something = something.downcase <span class="keyword">if</span> something</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">something = something &amp;&amp; something.downcase</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更好</span></span><br><span class="line">something &amp;&amp;= something.downcase</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用 case 语句等价操作符 <code>===</code> 。从名称可知，这是 <code>case</code> 表达式隐式使用的操作符，在 <code>case</code> 语句外的场合使用，会产生难以理解的代码。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">Array</span> === something</span><br><span class="line">(<span class="number">1</span>..<span class="number">100</span>) === <span class="number">7</span></span><br><span class="line">/something/ === some_string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">something.is_a?(<span class="constant">Array</span>)</span><br><span class="line">(<span class="number">1</span>..<span class="number">100</span>).<span class="keyword">include</span>?(<span class="number">7</span>)</span><br><span class="line">some_string =~ <span class="regexp">/something/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>能使用 <code>==</code> 时，就不要使用 <code>eql?</code>。提供更加严格比较的 <code>eql?</code> 在实践中极少使用。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差，对于字符串，eql? 和 == 作用相同</span></span><br><span class="line"><span class="string">"ruby"</span>.eql? some_str</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="string">"ruby"</span> == some_str</span><br><span class="line"><span class="number">1.0</span>.eql? x <span class="comment"># 当需要区别 Fixnum 1 与 Float 1.0 时，eql? 是具有意义的</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用 Perl 风格的特殊变量（像是 <code>$:</code>、<code>$;</code> 等）。它们看起来非常神秘，除非用于单行脚本，否则不鼓励使用。使用 <code>English</code> 库提供的友好别名。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="variable">$:</span>.unshift <span class="constant">File</span>.dirname(__FILE_<span class="number">_</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'English'</span></span><br><span class="line"><span class="variable">$LOAD_PATH</span>.unshift <span class="constant">File</span>.dirname(__FILE_<span class="number">_</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>永远不要在方法名与左括号之间放一个空格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">f (<span class="number">3</span> + <span class="number">2</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">f(<span class="number">3</span> + <span class="number">2</span>) + <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果方法的第一个参数由左括号开始的，则此方法调用应该使用括号，例如 <code>f((3 + 2) + 1)</code>。</p>
</li>
<li><p>总是使用 <code>-w</code> 来执行 Ruby 解释器，如果你忘了某个上述的规则，它就会警告你！</p>
</li>
<li><p>不要在方法中嵌套定义方法，使用 lambda 代替。<br>嵌套定义产生的方法，其实际上和外层方法处于同一作用域（比如类<br>作用域）。此外，“嵌套方法”会在定义它的外层方法每次调用时被重新定义。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(y)</span></span></span><br><span class="line">    <span class="comment"># 此处省略方法体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  bar(x)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好，作用同前，但 bar 不会在 foo 每次调用时被重新定义</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(y)</span></span></span><br><span class="line">  <span class="comment"># 此处省略方法体</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></span><br><span class="line">  bar(x)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></span><br><span class="line">  bar = -&gt;(y) &#123; ... &#125;</span><br><span class="line">  bar.call(x)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用新的 lambda 字面量语法定义单行区块，用 <code>lambda</code> 方法定义多行区块。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">lambda = lambda &#123; |a, b| a + b &#125;</span><br><span class="line">lambda.call(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确，但看着怪怪的</span></span><br><span class="line">l = -&gt;(a, b) <span class="keyword">do</span></span><br><span class="line">  tmp = a * <span class="number">7</span></span><br><span class="line">  tmp * b / <span class="number">50</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">l = -&gt;(a, b) &#123; a + b &#125;</span><br><span class="line">l.call(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">l = lambda <span class="keyword">do</span> |a, b|</span><br><span class="line">  tmp = a * <span class="number">7</span></span><br><span class="line">  tmp * b / <span class="number">50</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当定义一个简短且没有参数的 lambda 时，省略参数的括号。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">l = -&gt;() &#123; something &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">l = -&gt; &#123; something &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用 <code>proc</code> 而不是 <code>Proc.new</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">p = <span class="constant">Proc</span>.new &#123; |n| puts n &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">p = proc &#123; |n| puts n &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用 <code>proc.call()</code> 而不是 <code>proc[]</code> 或 <code>proc.()</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 看上去像枚举访问</span></span><br><span class="line">l = -&gt;(v) &#123; puts v &#125;</span><br><span class="line">l[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也不好 - 不常用的语法</span></span><br><span class="line">l = -&gt;(v) &#123; puts v &#125;</span><br><span class="line">l.(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">l = -&gt;(v) &#123; puts v &#125;</span><br><span class="line">l.call(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>未使用的区块参数和局部变量使用 <code>_</code> 前缀或直接使用 <code>_</code>（虽然表意性差些） 。Ruby解释器和RuboCop都能辨认此规则，并会抑制相关地有变量未使用的警告。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">result = hash.map &#123; |k, v| v + <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">something</span><span class="params">(x)</span></span></span><br><span class="line">  unused_var, used_var = something_else(x)</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">result = hash.map &#123; |_k, v| v + <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">something</span><span class="params">(x)</span></span></span><br><span class="line">  _unused_var, used_var = something_else(x)</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">result = hash.map &#123; |<span class="number">_</span>, v| v + <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">something</span><span class="params">(x)</span></span></span><br><span class="line">  <span class="number">_</span>, used_var = something_else(x)</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>$stdout/$stderr/$stdin</code> 而不是 <code>STDOUT/STDERR/STDIN</code>。<code>STDOUT/STDERR/STDIN</code> 是常量，虽然在 Ruby 中是可以给常量重新赋值的（可能是重定向到某个流），但解释器会警告。</p>
</li>
<li><p>使用 <code>warn</code> 而不是 <code>$stderr.puts</code>。除了更加清晰简洁，如果你需要的话，<br><code>warn</code> 还允许你压制（suppress）警告（通过 <code>-W0</code> 将警告级别设为 <code>0</code>）。</p>
</li>
<li><p>倾向使用 <code>sprintf</code> 和它的别名 <code>format</code> 而不是相当隐晦的 <code>String#%</code> 方法.</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="string">'%d %d'</span> % [<span class="number">20</span>, <span class="number">10</span>]</span><br><span class="line"><span class="comment"># =&gt; '20 10'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">sprintf(<span class="string">'%d %d'</span>, <span class="number">20</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment"># =&gt; '20 10'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">sprintf(<span class="string">'%&#123;first&#125; %&#123;second&#125;'</span>, <span class="symbol">first:</span> <span class="number">20</span>, <span class="symbol">second:</span> <span class="number">10</span>)</span><br><span class="line"><span class="comment"># =&gt; '20 10'</span></span><br><span class="line"></span><br><span class="line">format(<span class="string">'%d %d'</span>, <span class="number">20</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment"># =&gt; '20 10'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">format(<span class="string">'%&#123;first&#125; %&#123;second&#125;'</span>, <span class="symbol">first:</span> <span class="number">20</span>, <span class="symbol">second:</span> <span class="number">10</span>)</span><br><span class="line"><span class="comment"># =&gt; '20 10'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>倾向使用 <code>Array#join</code> 而不是相当隐晦的使用字符串作参数的 <code>Array#*</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="string">%w(one two three)</span> * <span class="string">', '</span></span><br><span class="line"><span class="comment"># =&gt; 'one, two, three'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="string">%w(one two three)</span>.join(<span class="string">', '</span>)</span><br><span class="line"><span class="comment"># =&gt; 'one, two, three'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当处理你希望将变量作为数组使用，但不确定它是不是数组时，<br>使用 <code>[*var]</code> 或 <code>Array()</code> 而不是显式的 <code>Array</code> 检查。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">paths = [paths] <span class="keyword">unless</span> paths.is_a? <span class="constant">Array</span></span><br><span class="line">paths.each &#123; |path| do_something(path) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">[*paths].each &#123; |path| do_something(path) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好（而且更具易读性一点）</span></span><br><span class="line"><span class="constant">Array</span>(paths).each &#123; |path| do_something(path) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>尽量使用范围或 <code>Comparable#between?</code> 来替换复杂的逻辑比较。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">do_something <span class="keyword">if</span> x &gt;= <span class="number">1000</span> &amp;&amp; x &lt; <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">if</span> (<span class="number">1000</span>...<span class="number">2000</span>).<span class="keyword">include</span>?(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">if</span> x.between?(<span class="number">1000</span>, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>尽量用谓词方法而不是使用 <code>==</code> 。比较数字除外。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x == <span class="keyword">nil</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> x.even?</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x.odd?</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x.<span class="keyword">nil</span>?</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x.zero?</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x == <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>除非是布尔值，不用显示检查它是否不是 <code>nil</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">do_something <span class="keyword">if</span> !something.<span class="keyword">nil</span>?</span><br><span class="line">do_something <span class="keyword">if</span> something != <span class="keyword">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">do_something <span class="keyword">if</span> something</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好——检查的是布尔值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">value_set?</span></span></span><br><span class="line">  !<span class="variable">@some_boolean</span>.<span class="keyword">nil</span>?</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用 <code>BEGIN</code> 区块。</p>
</li>
<li><p>使用 <code>Kernel#at_exit</code> 。永远不要用 <code>END</code> 区块。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"></span><br><span class="line"><span class="constant">END</span> &#123; puts <span class="string">'Goodbye!'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"></span><br><span class="line">at_exit &#123; puts <span class="string">'Goodbye!'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用 flip-flops 。</p>
</li>
<li><p>避免使用嵌套的条件来控制流程。</p>
<p>当你可能断言不合法的数据，使用一个防御从句。一个防御从句是一个在函数顶部的条件声明，这样如果数据不合法就能尽快的跳出函数。</p>
</li>
</ul>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_thing</span><span class="params">(thing)</span></span></span><br><span class="line">  <span class="keyword">if</span> thing[<span class="symbol">:foo</span>]</span><br><span class="line">    update_with_bar(thing)</span><br><span class="line">    <span class="keyword">if</span> thing[<span class="symbol">:foo</span>][<span class="symbol">:bar</span>]</span><br><span class="line">      partial_compute(thing)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      re_compute(thing)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_thing</span><span class="params">(thing)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">unless</span> thing[<span class="symbol">:foo</span>]</span><br><span class="line">  update_with_bar(thing[<span class="symbol">:foo</span>])</span><br><span class="line">  <span class="keyword">return</span> re_compute(thing) <span class="keyword">unless</span> thing[<span class="symbol">:foo</span>][<span class="symbol">:bar</span>]</span><br><span class="line">  partial_compute(thing)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</code></pre><p>  使用 <code>next</code> 而不是条件区块。</p>
<pre><code><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each <span class="keyword">do</span> |item|</span><br><span class="line">  <span class="keyword">if</span> item &gt; <span class="number">1</span></span><br><span class="line">    puts item</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each <span class="keyword">do</span> |item|</span><br><span class="line">  <span class="keyword">next</span> <span class="keyword">unless</span> item &gt; <span class="number">1</span></span><br><span class="line">  puts item</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>倾向使用 <code>map</code> 而不是 <code>collect</code> ， <code>find</code> 而不是 <code>detect</code> ， <code>select</code> 而不是 <code>find_all</code> ， <code>reduce</code> 而不是 <code>inject</code> 以及 <code>size</code> 而不是 <code>length</code> 。这不是一个硬性要求；如果使用别名增加了可读性，使用它没关系。这些有押韵的方法名是从 Smalltalk 继承而来，在别的语言不通用。鼓励使用 <code>select</code> 而不是 <code>find_all</code> 的理由是它跟 <code>reject</code> 搭配起来是一目了然的。</p>
</li>
<li><p>不要用 <code>count</code> 代替 <code>size</code>。除了<code>Array</code>其它<code>Enumerable</code>对象都需要遍历整个集合才能得到大小。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">some_hash.count</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">some_hash.size</span><br></pre></td></tr></table></figure>
</li>
<li><p>倾向使用 <code>flat_map</code> 而不是 <code>map</code> + <code>flatten</code> 的组合。<br>这并不适用于深度大于 2 的数组，举个例子，如果 <code>users.first.songs == [&#39;a&#39;, [&#39;b&#39;, &#39;c&#39;]]</code> ，则使用 <code>map + flatten</code> 的组合，而不是使用 <code>flat_map</code>。<br><code>flat_map</code> 将数组变平坦一个层级，而 <code>flatten</code> 会将整个数组变平坦。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">all_songs = users.map(&amp;<span class="symbol">:songs</span>).flatten.uniq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">all_songs = users.flat_map(&amp;<span class="symbol">:songs</span>).uniq</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>reverse_each</code> ，不用 <code>reverse.each</code> 。 <code>reverse_each</code> 不会重新分配新数组。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">array.reverse.each &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">array.reverse_each &#123; ... &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u547D_u540D"><a href="#u547D_u540D" class="headerlink" title="命名"></a>命名</h2><blockquote>
<p>程序设计的真正难题是替事物命名及使缓存失效。<br><br>——Phil Karlton</p>
</blockquote>
<ul>
<li><p>标识符用英语命名。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 变量名用非ascii字符</span></span><br><span class="line">заплата = <span class="number">1_000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差 - 变量名用带有拉丁文的保加利亚语写成。</span></span><br><span class="line">zaplata = <span class="number">1_000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">salary = <span class="number">1_000</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>符号、方法与变量使用蛇底式小写（snake_case）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="symbol">:<span class="string">'some symbol'</span></span></span><br><span class="line"><span class="symbol">:SomeSymbol</span></span><br><span class="line"><span class="symbol">:someSymbol</span></span><br><span class="line"></span><br><span class="line">someVar = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">someMethod</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SomeMethod</span></span></span><br><span class="line"> ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="symbol">:some_symbol</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>类与模块的命名应使用驼峰式大小写（CamelCase）。（HTTP、RFC、XML 这种首字母缩写应为大写。）</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Someclass</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Some_Class</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeXml</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeXML</span></span></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>文件名用蛇底式小写，如 <code>hello_world.rb</code>。</p>
</li>
<li><p>目录名用蛇底式小写，如 <code>lib/hello_world/hello_world.rb</code>。</p>
</li>
<li><p>尽量使一个源文件中只有一个类或模块。文件名就是类名或模块名，但采用蛇底式小写而不是驼峰式大小写。</p>
</li>
<li><p>其它常量的命名应使用尖叫蛇底式大写（SCREAMING_SNAKE_CASE）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">SomeConst</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">SOME_CONST</span> = <span class="number">5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>谓词方法的名字（返回布尔值的方法）应以问号结尾。 (例如： <code>Array#empty?</code> )。不返回布尔值的方法不应以问号结尾。</p>
</li>
<li><p>有潜在<strong>危险性</strong>的方法，若此<strong>危险</strong>方法有安全版本存在时，应以安全版本名加上惊叹号结尾（例如：改动 <code>self</code> 或参数、 <code>exit!</code> （不会向 <code>exit</code> 那样运行 finalizers）, 等等方法）。</p>
</li>
<li><p>如果存在潜在的<strong>危险</strong>方法（即修改 <code>self</code> 或者参数的方法，不像 <code>exit</code> 那样运行 finalizers 的 <code>exit!</code>，等等）的安全版本，那么 <em>危险</em> 方法的名字应该以惊叹号结尾。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不好 - 没有对应的安全方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update!</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update!</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果可能的话，根据危险方法（bang）来定义对应的安全方法（non-bang）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Array</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatten_once!</span></span></span><br><span class="line">    res = []</span><br><span class="line"></span><br><span class="line">    each <span class="keyword">do</span> |e|</span><br><span class="line">      [*e].each &#123; |f| res &lt;&lt; f &#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    replace(res)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatten_once</span></span></span><br><span class="line">    dup.flatten_once!</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在简短区块中使用 <code>reduce</code> 时，把参数命名为 <code>|a, e|</code> (累加器（<code>accumulator</code>），元素（<code>element</code>）)</p>
</li>
<li><p>在定义二元操作符时，把参数命名为 <code>other</code> （<code>&lt;&lt;</code> 与 <code>[]</code> 是这条规则的例外，因为它们的语义不同）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">+</span><span class="params">(other)</span></span></span><br><span class="line">  <span class="comment"># 此处省略方法体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u6CE8_u91CA"><a href="#u6CE8_u91CA" class="headerlink" title="注释"></a>注释</h2><blockquote>
<p>良好的代码自身就是最佳的文档。当你要添加一个注释时，扪心自问，“如何改善代码让它不需要注释？” 改善代码，再写相应文档使之更清楚。<br><br>——Steve McConnell</p>
</blockquote>
<ul>
<li><p>编写让人一目了然的代码然后忽略这一节的其它部分。我是认真的！</p>
</li>
<li><p>用英语写注释。</p>
</li>
<li><p><code>#</code> 与注释文本之间应有一个空格。</p>
</li>
<li><p>注释超过一个单词时句首字母应大写，并且在句子停顿或结尾处使用标点符号。句号后使用<a href="http://en.wikipedia.org/wiki/Sentence_spacing" target="_blank" rel="external">一个空格</a>。</p>
</li>
<li><p>避免肤浅的注释。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">counter += <span class="number">1</span> <span class="comment"># 计数器加一</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>及时更新注释。过时的注时比没有注释还糟糕。</p>
</li>
</ul>
<blockquote>
<p>好代码就像是好的笑话 - 它不需要解释。<br><br>——Russ Olsen</p>
</blockquote>
<ul>
<li>避免替烂代码写注释。重构代码让它们看起来一目了然。（要么做，要么不做——不要只是试试看。——Yoda）</li>
</ul>
<h3 id="u6CE8_u89E3"><a href="#u6CE8_u89E3" class="headerlink" title="注解"></a>注解</h3><ul>
<li><p>注解应该直接写在相关代码那行之前。</p>
</li>
<li><p>注解关键字后面，跟着一个冒号及空格，接着是描述问题的文字。</p>
</li>
<li><p>如果需要用多行来描述问题，后续行要放在 <code>#</code> 号后面并缩排两个空格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span></span></span><br><span class="line">  <span class="comment"># <span class="doctag">FIXME:</span> 这在 v3.2.1 版本之后会异常崩溃，或许与</span></span><br><span class="line">  <span class="comment">#   BarBazUtil 的版本更新有关</span></span><br><span class="line">  baz(<span class="symbol">:quux</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在问题是显而易见的情况下，任何的文档会是多余的，注解应放在有问题的那行的最后，并且不需更多说明。这个用法应该是例外而不是规则。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span></span></span><br><span class="line">  sleep <span class="number">100</span> <span class="comment"># OPTIMIZE</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>TODO</code> 标记以后应加入的特征与功能。</p>
</li>
<li><p>使用 <code>FIXME</code> 标记需要修复的代码。</p>
</li>
<li><p>使用 <code>OPTIMIZE</code> 标记可能影响性能的缓慢或效率低下的代码。</p>
</li>
<li><p>使用 <code>HACK</code> 标记代码异味，即那些应该被重构的可疑编码习惯。</p>
</li>
<li><p>使用 <code>REVIEW</code> 标记需要确认其编码意图是否正确的代码。举例来说：<code>REVIEW: 我们确定用户现在是这么做的吗？</code></p>
</li>
<li><p>如果你觉得恰当的话，可以使用其他定制的注解关键字，但别忘记录在项目的 <code>README</code> 或类似文档中。</p>
</li>
</ul>
<h2 id="u7C7B_u4E0E_u6A21_u5757"><a href="#u7C7B_u4E0E_u6A21_u5757" class="headerlink" title="类与模块"></a>类与模块</h2><ul>
<li><p>在类定义语句中使用一致的结构。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="comment"># 首先是 extend 与 include</span></span><br><span class="line">  extend <span class="constant">SomeModule</span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">AnotherModule</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 内部类</span></span><br><span class="line">  <span class="constant">CustomErrorKlass</span> = <span class="constant">Class</span>.new(<span class="constant">StandaError</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 接着是常量</span></span><br><span class="line">  <span class="constant">SOME_CONSTANT</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 接下来是属性宏</span></span><br><span class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:name</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 跟着是其它的宏（如果有的话）</span></span><br><span class="line">  validates <span class="symbol">:name</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 公开的类别方法接在下一行</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_method</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 初始化方法在类方法和实例方法之间</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 跟着是公开的实例方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 受保护及私有的方法，一起放在接近结尾的地方</span></span><br><span class="line">  protected</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_protected_method</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  private</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_private_method</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果某个类需要多行代码，则不要嵌套在其它类中。应将其独立写在文件中，存放以包含它的类的的名字命名的文件夹中。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># foo.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></span><br><span class="line">    <span class="comment"># 30个方法</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></span><br><span class="line">    <span class="comment"># 20个方法</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 30个方法</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># foo.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line">  <span class="comment"># 30个方法</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># foo/bar.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></span><br><span class="line">    <span class="comment"># 30个方法</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># foo/car.rb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></span><br><span class="line">    <span class="comment"># 20个方法</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>定义类方法时，优先使用模块而不是类。只有当需要实例化时才使用类。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_method</span></span></span><br><span class="line">    <span class="comment"># 省略函数体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_other_method</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">SomeClass</span></span></span><br><span class="line">  module_function</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></span><br><span class="line">    <span class="comment"># 省略函数体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_other_method</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当你想将模块的实例方法变成类方法时，优先使用 <code>module_function</code> 而不是 <code>extend self</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Utilities</span></span></span><br><span class="line">  extend <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_something</span><span class="params">(string)</span></span></span><br><span class="line">    <span class="comment"># 做一些事</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">other_utility_method</span><span class="params">(number, string)</span></span></span><br><span class="line">    <span class="comment"># 做另一些事</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Utilities</span></span></span><br><span class="line">  module_function</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_something</span><span class="params">(string)</span></span></span><br><span class="line">    <span class="comment"># 做一些事</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">other_utility_method</span><span class="params">(number, string)</span></span></span><br><span class="line">    <span class="comment"># 做另一些事</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当设计类的层次结构时，确认它们符合 <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_blank" rel="external">里式替换原则</a>。</p>
</li>
<li><p>让你的类尽可能 <a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design" target="_blank" rel="external">SOLID</a>) 。</p>
</li>
<li><p>永远替那些用以表示领域模型的类提供一个适当的 <code>to_s</code> 方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></span><br><span class="line">    <span class="variable">@first_name</span> = first_name</span><br><span class="line">    <span class="variable">@last_name</span> = last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></span><br><span class="line">    <span class="string">"<span class="subst">#&#123;<span class="variable">@first_name</span>&#125;</span> <span class="subst">#&#123;<span class="variable">@last_name</span>&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>attr</code> 系列函数来定义琐碎的访问器或修改器。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></span><br><span class="line">    <span class="variable">@first_name</span> = first_name</span><br><span class="line">    <span class="variable">@last_name</span> = last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></span><br><span class="line">    <span class="variable">@first_name</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">last_name</span></span></span><br><span class="line">    <span class="variable">@last_name</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></span><br><span class="line">    <span class="variable">@first_name</span> = first_name</span><br><span class="line">    <span class="variable">@last_name</span> = last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要使用 <code>attr</code>。使用 <code>attr_reader</code> 和 <code>attr_accessor</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - ruby 1.9 中就不推荐了</span></span><br><span class="line">attr <span class="symbol">:something</span>, <span class="keyword">true</span></span><br><span class="line">attr <span class="symbol">:one</span>, <span class="symbol">:two</span>, <span class="symbol">:three</span> <span class="comment"># behaves as attr_reader</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">attr_accessor</span> <span class="symbol">:something</span></span><br><span class="line"><span class="keyword">attr_reader</span> <span class="symbol">:one</span>, <span class="symbol">:two</span>, <span class="symbol">:three</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>考虑使用 <code>Struct.new</code>，它替你定义了那些琐碎的访问器（accessors），构造器（constructor）以及比较操作符（comparison operators）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></span><br><span class="line">    <span class="variable">@first_name</span> = first_name</span><br><span class="line">    <span class="variable">@last_name</span> = last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更好</span></span><br><span class="line"><span class="constant">Person</span> = <span class="constant">Struct</span>.new(<span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>) <span class="keyword">do</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要扩展 <code>Struct.new</code>。它已经是个类了。对它扩展不但引入了无意义的类的层次也会在该文件多次被 require 时出现奇怪的错误。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="inheritance">&lt; <span class="parent">Struct</span></span>.<span class="title">new</span>(:<span class="title">first_name</span>, :<span class="title">last_name</span>)</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">Person</span> = <span class="constant">Struct</span>.new(<span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>考虑加入工厂方法以提供附加的有意义的方式来生成一个特定的类实例。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">create</span><span class="params">(options_hash)</span></span></span><br><span class="line">    <span class="comment"># 此处省略方法体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>倾向使用<a href="http://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="external">鸭子类型</a> 而不是继承。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 差</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></span><br><span class="line">  <span class="comment"># 抽象方法</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承超类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span> <span class="inheritance">&lt; <span class="parent">Animal</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></span><br><span class="line">    puts <span class="string">'Quack! Quack'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承超类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="inheritance">&lt; <span class="parent">Animal</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></span><br><span class="line">    puts <span class="string">'Bau! Bau!'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 好</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></span><br><span class="line">    puts <span class="string">'Quack! Quack'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></span><br><span class="line">    puts <span class="string">'Bau! Bau!'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>由于类变量在继承中产生的“讨厌的”行为，避免使用类变量（<code>@@</code>）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span></span><br><span class="line">  <span class="variable">@@class_var</span> = <span class="string">'parent'</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">print_class_var</span></span></span><br><span class="line">    puts <span class="variable">@@class_var</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="inheritance">&lt; <span class="parent">Parent</span></span></span></span><br><span class="line">  <span class="variable">@@class_var</span> = <span class="string">'child'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Parent</span>.print_class_var <span class="comment"># =&gt; will print "child"</span></span><br></pre></td></tr></table></figure>
<p>  如同你所看到的，在类型层级中的所有类其实都共享单独一个类变量。通常情况下应该倾向使用实例变量而不是类变量。</p>
</li>
<li><p>依据方法的目的用途指定适当的可见层级（<code>private</code>，<code>protected</code>）。别把所有方法都设为 <code>public</code>（方法的缺省值）。我们现在是在写“Ruby”，不是“Python”。</p>
</li>
<li><p>将 <code>public</code>，<code>protected</code>，<code>private</code> 和被应用的方法定义保持一致的缩排。在上下各留一行来强调这个可见性应用于之后的所有方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">public_method</span></span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  private</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">private_method</span></span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">another_private_method</span></span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>def self.method</code> 来定义方法。在代码重构时如果修改类名也无需重复多次修改了。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></span><br><span class="line">  <span class="comment"># 差</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">TestClass</span>.<span class="title">some_method</span></span></span><br><span class="line">    <span class="comment"># 省略方法体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 好</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_other_method</span></span></span><br><span class="line">    <span class="comment"># 省略方法体</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 当你需要定义很多个类时，另一种便捷的方式</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="inheritance">&lt;</span><span class="inheritance">&lt; <span class="parent">self</span></span></span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_method</span></span></span><br><span class="line">      <span class="comment"># 省略方法体</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">second_method_etc</span></span></span><br><span class="line">      <span class="comment"># 省略方法体</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在类的语法作用域中定义别名时优先使用 <code>alias</code>，因为 <code>alias</code> 有词法作用域，<code>self</code> 对象是源代码被读取时候的值（不是运行时候的 <code>self</code>），她清楚地告诉使用程序员，除非明确说明，否则方法别名的引用不会在运行时被改变或者被任何子类改变。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Westerner</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></span><br><span class="line">    <span class="variable">@names</span>.first</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">alias</span> given_name first_name</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>因为 <code>alias</code> 和 <code>def</code> 一样，是关键词，相比字符串和符号，优先使用裸字（bareword）；也就是说，这样使用 <code>alias foo bar</code>， 不是 <code>alias :foo :bar</code>。<br>另外要知道 Ruby 怎么处理别名和继承，方法别名定义后，即使对应的方法在后面的代码中重新定义（即修改内部实现）后，<br>别名仍然可以调用到修改前的方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fugitive</span> <span class="inheritance">&lt; <span class="parent">Westerner</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></span><br><span class="line">    <span class="string">'Nobody'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>这个例子中，<code>Fugitive#given_name</code> 仍然调用原来的 <code>Westerner#first_name</code>方法，而不是 <code>Fugitive#first_name</code> 方法。<br>要想覆写 <code>Fugitive#given_name</code> 行为，必须在类中重新定义一次。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fugitive</span> <span class="inheritance">&lt; <span class="parent">Westerner</span></span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></span><br><span class="line">    <span class="string">'Nobody'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">alias</span> given_name first_name</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>运行时定义模块方法，类方法和单件类方法别名，总是使用 <code>alias_method</code>。因为在上述情况下 <code>alias</code> 会导致不可预期的结果</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Mononymous</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">included</span><span class="params">(other)</span></span></span><br><span class="line">    other.class_eval &#123; alias_method <span class="symbol">:full_name</span>, <span class="symbol">:given_name</span> &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sting</span> <span class="inheritance">&lt; <span class="parent">Westerner</span></span></span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">Mononymous</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u5F02_u5E38"><a href="#u5F02_u5E38" class="headerlink" title="异常"></a>异常</h2><ul>
<li><p>使用 <code>fail</code> 方法来抛出异常。仅在捕捉到异常时使用 <code>raise</code> 来重新抛出异常（因为没有失败，所以只是显式地有目的性地抛出一个异常）</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line"> fail <span class="string">'Oops'</span>;</span><br><span class="line"><span class="keyword">rescue</span> =&gt; error</span><br><span class="line">  raise <span class="keyword">if</span> error.message != <span class="string">'Oops'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果 <code>fail/raise</code> 只有两个参数，无需显性指定 <code>RuntimeError</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">fail <span class="constant">RuntimeError</span>, <span class="string">'message'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好——默认就是 RuntimeError</span></span><br><span class="line">fail <span class="string">'message'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将异常类和消息作为参数给 <code>fail/raise</code> ，而不是异常类的的实例。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">fail <span class="constant">SomeException</span>.new(<span class="string">'message'</span>)</span><br><span class="line"><span class="comment"># 无法使用 `fail SomeException.new('message'), backtrace`.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">fail <span class="constant">SomeException</span>, <span class="string">'message'</span></span><br><span class="line"><span class="comment"># 可以使用 `fail SomeException, 'message', backtrace`.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>永远不要从 <code>ensure</code> 区块返回。如果你显式地从 <code>ensure</code> 区块中的一个方法返回，那么这方法会如同没有异常般的返回。实际上，异常会被默默丢掉。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></span><br><span class="line">  fail</span><br><span class="line"><span class="keyword">ensure</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'very bad idea'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>尽可能使用隐式的 <code>begin</code> 区块。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="comment"># 此处放主要逻辑</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="comment"># 错误处理放在此处</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></span><br><span class="line">  <span class="comment"># 此处放主要逻辑</span></span><br><span class="line"><span class="keyword">rescue</span></span><br><span class="line">  <span class="comment"># 错误处理放在此处</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过 <em>contingency</em> 方法 (一个由 Avdi Grimm 创造的词) 来减少 <code>begin</code> 区块的使用。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  something_that_might_fail</span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">IOError</span></span><br><span class="line">  <span class="comment"># 处理 IOError</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  something_else_that_might_fail</span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">IOError</span></span><br><span class="line">  <span class="comment"># 处理 IOError</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_io_error_handling</span></span></span><br><span class="line">   <span class="keyword">yield</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">IOError</span></span><br><span class="line">  <span class="comment"># 处理 IOError</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">with_io_error_handling &#123; something_that_might_fail &#125;</span><br><span class="line"></span><br><span class="line">with_io_error_handling &#123; something_else_that_might_fail &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要抑制异常。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># 这里发生了一个异常</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">SomeError</span></span><br><span class="line">  <span class="comment"># 拯救子句完全没有做事</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">do_something <span class="keyword">rescue</span> <span class="keyword">nil</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用 <code>rescue</code> 的修饰符形式。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 这里将会捕捉 StandardError 及其所有子孙类的异常。</span></span><br><span class="line">read_file <span class="keyword">rescue</span> handle_error(<span class="variable">$!</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 - 这里只会捕获 Errno::ENOENT 及其所有子孙类的异常</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></span><br><span class="line">  read_file</span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">Errno::ENOENT</span> =&gt; ex</span><br><span class="line">  handle_error(ex)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要为了控制流程而使用异常。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  n / d</span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">ZeroDivisionError</span></span><br><span class="line">  puts <span class="string">'Cannot divide by 0!'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">if</span> d.zero?</span><br><span class="line">  puts <span class="string">'Cannot divide by 0!'</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  n / d</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>避免救援 <code>Exception</code> 类别。这会把信号困住，并呼叫 <code>exit</code>，导致你需要 <code>kill -9</code> 进程。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># 呼叫 exit 及杀掉信号会被捕捉（除了 kill -9）</span></span><br><span class="line">  exit</span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">Exception</span></span><br><span class="line">  puts <span class="string">"you didn't really want to exit, right?"</span></span><br><span class="line">  <span class="comment"># 异常处理</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># 一个不明确的 rescue 子句捕捉的是 StandardError，</span></span><br><span class="line">  <span class="comment"># 而不是许多编程者所设想的 Exception。</span></span><br><span class="line"><span class="keyword">rescue</span> =&gt; e</span><br><span class="line">  <span class="comment"># 异常处理</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也好</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># 这里发生一个异常</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">StandardError</span> =&gt; e</span><br><span class="line">  <span class="comment"># 异常处理</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把较具体的异常放在救援链的较上层，不然它们永远不会被拯救。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># 一些代码</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">Exception</span> =&gt; e</span><br><span class="line">  <span class="comment"># 一些处理</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">StandardError</span> =&gt; e</span><br><span class="line">  <span class="comment"># 一些处理</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># 一些代码</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">StandardError</span> =&gt; e</span><br><span class="line">  <span class="comment"># 一些处理</span></span><br><span class="line"><span class="keyword">rescue</span> <span class="constant">Exception</span> =&gt; e</span><br><span class="line">  <span class="comment"># 一些处理</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>ensure</code> 区块中释放程序的外部资源。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="constant">File</span>.open(<span class="string">'testfile'</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment"># .. 处理</span></span><br><span class="line"><span class="keyword">rescue</span></span><br><span class="line">  <span class="comment"># .. 错误处理</span></span><br><span class="line"><span class="keyword">ensure</span></span><br><span class="line">  f.close <span class="keyword">if</span> f</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用资源获取方法时，尽可能使用具备自动清理功能的版本。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差，需要显式关闭文件描述符</span></span><br><span class="line">f = <span class="constant">File</span>.open(<span class="string">'testfile'</span>)</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">f.close</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好，文件描述符会被自动关闭</span></span><br><span class="line"><span class="constant">File</span>.open(<span class="string">'testfile'</span>) <span class="keyword">do</span> |f|</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>倾向使用标准库的异常类而不是导入新的异常类。</p>
</li>
</ul>
<h2 id="u96C6_u5408"><a href="#u96C6_u5408" class="headerlink" title="集合"></a>集合</h2><ul>
<li><p>倾向数组及哈希的字面表示法（除非你需要给构造器传入参数）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">arr = <span class="constant">Array</span>.new</span><br><span class="line">hash = <span class="constant">Hash</span>.new</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">arr = []</span><br><span class="line">hash = &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建元素为单词（没有空格和特殊符号）的数组时，用 <code>%w</code> 而不是 [] 方法。仅当数组有两个及以上元素时才应用这个规则。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">STATES</span> = [<span class="string">'draft'</span>, <span class="string">'open'</span>, <span class="string">'closed'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">STATES</span> = <span class="string">%w(draft open closed)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当你需要一个符号的数组（并且不需要保持 Ruby 1.9 兼容性）时，使用 <code>%i</code>。仅当数组只有两个及以上元素时才应用这个规则。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">STATES</span> = [<span class="symbol">:draft</span>, <span class="symbol">:open</span>, <span class="symbol">:closed</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">STATES</span> = %i(draft open closed)</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免在 <code>Array</code> 和 <code>Hash</code> 字面量中的最后一个元素后面使用逗号，特别是元素同一行的情况下。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差 - 方面移动、增加和修改参数，但仍不建议使用</span></span><br><span class="line"><span class="constant">VALUES</span> = [</span><br><span class="line">          <span class="number">1001</span>,</span><br><span class="line">          <span class="number">2020</span>,</span><br><span class="line">          <span class="number">3333</span>,</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">VALUES</span> = [<span class="number">1001</span>, <span class="number">2020</span>, <span class="number">3333</span>, ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">VALUES</span> = [<span class="number">1001</span>, <span class="number">2020</span>, <span class="number">3333</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免在数组中创造巨大的间隔。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr = []</span><br><span class="line">arr[<span class="number">100</span>] = <span class="number">1</span> <span class="comment"># 现在你有一个很多 nil 的数组</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当访问数组的首元素或尾元素时，尽量使用 <code>first</code> 或 <code>last</code>， 而非 <code>[0]</code> 或 <code>[-1]</code>。</p>
</li>
<li><p>当处理的元素没有重复时，使用 <code>Set</code> 来替代 <code>Array</code> 。 <code>Set</code> 实现了无序、无重复值的集合。 <code>Set</code> 的方法同数组类一样直观，还可像哈希中那样快速查找元素。</p>
</li>
<li><p>尽量用符号来取代字符串作为哈希的键。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">hash = &#123; <span class="string">'one'</span> =&gt; <span class="number">1</span>, <span class="string">'two'</span> =&gt; <span class="number">2</span>, <span class="string">'three'</span> =&gt; <span class="number">3</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">hash = &#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>, <span class="symbol">three:</span> <span class="number">3</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用可变的对象作为哈希的键。</p>
</li>
<li><p>当哈希的键为符号时，使用 Ruby 1.9 的哈希的字面语法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">hash = &#123; <span class="symbol">:one</span> =&gt; <span class="number">1</span>, <span class="symbol">:two</span> =&gt; <span class="number">2</span>, <span class="symbol">:three</span> =&gt; <span class="number">3</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">hash = &#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>, <span class="symbol">three:</span> <span class="number">3</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>但哈希的键有符号也有字符串时，不使用Ruby 1.9的字面量语法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">&#123; <span class="symbol">a:</span> <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">&#123; <span class="symbol">:a</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用 <code>Hash#key?</code> 不用 <code>Hash#has_key?</code>；用 <code>Hash#value?</code> 不用 <code>Hash#has_value?</code>。Matz <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/43765" target="_blank" rel="external">在此</a>提及，考虑废弃较长形式的方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">hash.has_key?(<span class="symbol">:test</span>)</span><br><span class="line">hash.has_value?(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">hash.key?(<span class="symbol">:test</span>)</span><br><span class="line">hash.value?(value)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在处理应该存在的哈希键时，使用 <code>Hash#fetch</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">heroes = &#123; <span class="symbol">batman:</span> <span class="string">'Bruce Wayne'</span>, <span class="symbol">superman:</span> <span class="string">'Clark Kent'</span> &#125;</span><br><span class="line"><span class="comment"># 差 - 如果我们打错字的话，我们就无法找到对的英雄了</span></span><br><span class="line">heroes[<span class="symbol">:batman</span>] <span class="comment"># =&gt; "Bruce Wayne"</span></span><br><span class="line">heroes[<span class="symbol">:supermen</span>] <span class="comment"># =&gt; nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 - fetch 会抛出一个 KeyError 来使这个问题明显</span></span><br><span class="line">heroes.fetch(<span class="symbol">:supermen</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在使用 <code>Hash#fetch</code> 时，使用第二个参数设置默认值。</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">batman = &#123; <span class="symbol">name:</span> <span class="string">'Bruce Wayne'</span>, <span class="symbol">is_evil:</span> <span class="keyword">false</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差 - 如果我们仅仅使用 || 操作符，那么当值为假时，我们不会得到预期的结果</span></span><br><span class="line">batman[<span class="symbol">:is_evil</span>] || <span class="keyword">true</span> <span class="comment"># =&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 - fetch 在遇到假值时依然正确</span></span><br><span class="line">batman.fetch(<span class="symbol">:is_evil</span>, <span class="keyword">true</span>) <span class="comment"># =&gt; false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果求值的代码有副作用或者开销大，尽量用 <code>Hash#fetch</code> 加区块而不是直接设定默认值。</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">batman = &#123; <span class="symbol">name:</span> <span class="string">'Bruce Wayne'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差 - 默认值是立即求值</span></span><br><span class="line">batman.fetch(<span class="symbol">:powers</span>, obtain_batman_powers) <span class="comment"># obtain_batman_powers 需要复杂的计算</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好 - 区块是惰性求值，只有当 KeyError 异常时才执行</span></span><br><span class="line">batman.fetch(<span class="symbol">:powers</span>) &#123; obtain_batman_powers &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当需要从哈希中同时获取多个键值时，使用 <code>Hash#values_at</code>。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">email = data[<span class="string">'email'</span>]</span><br><span class="line">username = data[<span class="string">'nickname'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">email, username = data.values_at(<span class="string">'email'</span>, <span class="string">'nickname'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ruby 1.9 的哈希是有序的，利用这个特性。</p>
</li>
<li><p>在遍历一个集合时，不要改动它。</p>
</li>
<li><p>当访问集合中的元素时，避免通过 <code>[n]</code> 直接访问，尽量使用提供的方法。这样可以防止你对 <code>nil</code> 调用 <code>[]</code>。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="constant">Regexp</span>.last_match[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="constant">Regexp</span>.last_match(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>为集合提供存取器时，在访问元素之前采用一种替代的形式，从而防止用户访问的下标是 <code>nil</code>。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">awesome_things</span></span></span><br><span class="line">  <span class="variable">@awesome_things</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">awesome_things</span><span class="params">(index = <span class="keyword">nil</span>)</span></span></span><br><span class="line">  <span class="keyword">if</span> index &amp;&amp; <span class="variable">@awesome_things</span></span><br><span class="line">    <span class="variable">@awesome_things</span>[index]</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="variable">@awesome_things</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u5B57_u7B26_u4E32"><a href="#u5B57_u7B26_u4E32" class="headerlink" title="字符串"></a>字符串</h2><ul>
<li><p>尽量使用字符串插值（interpolation），而不是字符串连接（concatenation）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">email_with_name = user.name + <span class="string">' &lt;'</span> + user.email + <span class="string">'&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">email_with_name = <span class="string">"<span class="subst">#&#123;user.name&#125;</span> &lt;<span class="subst">#&#123;user.email&#125;</span>&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">email_with_name = format(<span class="string">'%s &lt;%s&gt;'</span>, user.name, user.email)</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于插值表达式, 括号内不应有留白（padded-spacing）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="string">"From: <span class="subst">#&#123; user.first_name &#125;</span>, <span class="subst">#&#123; user.last_name &#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="string">"From: <span class="subst">#&#123;user.first_name&#125;</span>, <span class="subst">#&#123;user.last_name&#125;</span>"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>选定一个字符串字面量创建的风格。Ruby 社区认可两种分割，默认用单引号（风格 A）和默认用双引号（风格 B）</p>
<ul>
<li><p><strong>（风格 A）</strong>当你不需要插入特殊符号如 <code>\t</code>, <code>\n</code>, <code>&#39;</code>, 等等时，尽量使用单引号的字符串。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">name = <span class="string">"Bozhidar"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">name = <span class="string">'Bozhidar'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>（风格 B）</strong> 用双引号。除非字符串中含有双引号，或者含有你希望抑制的转义字符。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">name = <span class="string">'Bozhidar'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">name = <span class="string">"Bozhidar"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>有争议的是，第二种风格在 Ruby 社区里更受欢迎一些。但是本指南中字符串采用第一种风格。</p>
</li>
<li><p>不要用 <code>?x</code>。从 Ruby 1.9 开始， <code>?x</code> 和 <code>&#39;x&#39;</code> 是等价的（只包括一个字符的字符串）。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">char = <span class="string">?c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">char = <span class="string">'c'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>别忘了使用 <code>{}</code> 来围绕被插入字符串的实例与全局变量。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></span><br><span class="line">    <span class="variable">@first_name</span> = first_name</span><br><span class="line">    <span class="variable">@last_name</span> = last_name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 差 - 有效，但难看</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></span><br><span class="line">    <span class="string">"#@first_name #@last_name"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 好</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></span><br><span class="line">    <span class="string">"<span class="subst">#&#123;<span class="variable">@first_name</span>&#125;</span> <span class="subst">#&#123;<span class="variable">@last_name</span>&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$global</span> = <span class="number">0</span></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">puts <span class="string">"$global = #$global"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">puts <span class="string">"$global = <span class="subst">#&#123;<span class="variable">$global</span>&#125;</span>"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串插值不要用 <code>Object#to_s</code> 。Ruby 默认会调用该方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">message = <span class="string">"This is the <span class="subst">#&#123;result.to_s&#125;</span>."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">message = <span class="string">"This is the <span class="subst">#&#123;result&#125;</span>."</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当你需要建构庞大的数据块（chunk）时，避免使用 <code>String#+</code> 。<br>使用 <code>String#&lt;&lt;</code> 来替代。<code>&lt;&lt;</code> 原位地改变字符串实例，因此比 <code>String#+</code> 来得快。<code>String#+</code> 创造了一堆新的字符串对象。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 好也比较快</span></span><br><span class="line">html = <span class="string">''</span></span><br><span class="line">html &lt;&lt; <span class="string">'&lt;h1&gt;Page title&lt;/h1&gt;'</span></span><br><span class="line"></span><br><span class="line">paragraphs.each <span class="keyword">do</span> |paragraph|</span><br><span class="line">  html &lt;&lt; <span class="string">"&lt;p&gt;<span class="subst">#&#123;paragraph&#125;</span>&lt;/p&gt;"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当你可以选择更快速、更专门的替代方法时，不要使用 <code>String#gsub</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">'http://example.com'</span></span><br><span class="line">str = <span class="string">'lisp-case-rules'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">url.gsub(<span class="string">"http://"</span>, <span class="string">"https://"</span>)</span><br><span class="line">str.gsub(<span class="string">"-"</span>, <span class="string">"_"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">url.sub(<span class="string">"http://"</span>, <span class="string">"https://"</span>)</span><br><span class="line">str.tr(<span class="string">"-"</span>, <span class="string">"_"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>heredocs 中的多行文字会保留前缀空白。因此做好如何缩进的规划。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">code = &lt;&lt;-<span class="constant">END</span>.gsub(<span class="regexp">/^\s+\|/</span>, <span class="string">''</span>)</span><br><span class="line">  |<span class="function"><span class="keyword">def</span> <span class="title">test</span></span></span><br><span class="line">  |  some_method</span><br><span class="line">  |  other_method</span><br><span class="line">  |<span class="keyword">end</span></span><br><span class="line"><span class="constant">END</span></span><br><span class="line"><span class="comment">#=&gt; "def\n  some_method\n  \nother_method\nend"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u6B63_u5219_u8868_u8FBE_u5F0F"><a href="#u6B63_u5219_u8868_u8FBE_u5F0F" class="headerlink" title="正则表达式"></a>正则表达式</h2><blockquote>
<p>有些人在面对问题时，不经大脑便认为，「我知道，这里该用正则表达式」。现在他要面对两个问题了。<br><br>——Jamie Zawinski</p>
</blockquote>
<ul>
<li><p>如果只需要在字符串中简单的搜索文字，不要使用正则表达式：<code>string[&#39;text&#39;]</code>。</p>
</li>
<li><p>针对简单的字符串查询，可以直接在字符串索引中直接使用正则表达式。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match = string[<span class="regexp">/regexp/</span>]             <span class="comment"># 获得匹配正则表达式的内容</span></span><br><span class="line">first_group = string[<span class="regexp">/text(grp)/</span>, <span class="number">1</span>] <span class="comment"># 获得分组的内容</span></span><br><span class="line">string[<span class="regexp">/text (grp)/</span>, <span class="number">1</span>] = <span class="string">'replace'</span>  <span class="comment"># string =&gt; 'text replace'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当你不需要替分组结果时，使用非捕获组。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/(first|second)/   <span class="comment"># 差</span></span><br><span class="line">/(?:first|second)/ <span class="comment"># 好</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要使用 Perl 遗风的变量来表示捕获的正则分组（如 <code>$1</code> 、 <code>$2</code> 等），它们看起来神神秘秘的。使用 <code>Regexp.last_match(n)</code>。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/(regexp)/ =~ string</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 差</span></span><br><span class="line">process <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">process <span class="constant">Regexp</span>.last_match(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>避免使用数字来获取分组。因为很难明白它们代表的意思。应该使用命名分组来替代。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">/(regexp)/ =~ string</span><br><span class="line">...</span><br><span class="line">process <span class="constant">Regexp</span>.last_match(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">/(?&lt;meaningful_var&gt;regexp)/ =~ string</span><br><span class="line">...</span><br><span class="line">process meaningful_var</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符类别只有几个你需要关心的特殊字符：<code>^</code>、<code>-</code>、<code>\</code>、<code>]</code>，所以你不用转义 <code>[]</code> 中的 <code>.</code> 或中括号。</p>
</li>
<li><p>小心使用 <code>^</code> 与 <code>$</code> ，它们匹配的是一行的开始与结束，不是字符串的开始与结束。如果你想要匹配整个字符串，使用 <code>\A</code> 与 <code>\z</code>。(译注：<code>\Z</code> 实为 <code>/\n?\z/</code>，使用 <code>\z</code> 才能匹配到有含新行的字符串的结束)</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string = <span class="string">"some injection\nusername"</span></span><br><span class="line">string[<span class="regexp">/^username$/</span>]   <span class="comment"># 匹配</span></span><br><span class="line">string[<span class="regexp">/\Ausername\z/</span>] <span class="comment"># 不匹配</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>针对复杂的正则表达式，使用 <code>x</code> 修饰符。可提高可读性并可以加入有用的注释。只是要注意空白字符会被忽略。</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">regexp = /</span><br><span class="line">  start         # 一些文本</span><br><span class="line">  \s            # 空白字符</span><br><span class="line">  (group)       # 第一组</span><br><span class="line">  (?:alt1|alt2) # 一些替代方案</span><br><span class="line">  end</span><br><span class="line">/x</span><br></pre></td></tr></table></figure>
</li>
<li><p>针对复杂的替换，<code>sub</code> 或 <code>gsub</code> 可以与区块或哈希结合使用。</p>
</li>
</ul>
<h2 id="u767E_u5206_u53F7_u5B57_u9762_u91CF"><a href="#u767E_u5206_u53F7_u5B57_u9762_u91CF" class="headerlink" title="百分号字面量"></a>百分号字面量</h2><ul>
<li><p>需要插值与嵌入双引号的单行字符串使用 <code>%()</code> （是 <code>%Q</code> 的简写）。多行字符串，最好用 heredocs 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差（不需要插值）</span></span><br><span class="line"><span class="string">%(&lt;div class="text"&gt;Some text&lt;/div&gt;)</span></span><br><span class="line"><span class="comment"># 应该使用 '&lt;div class="text"&gt;Some text&lt;/div&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差（没有双引号）</span></span><br><span class="line"><span class="string">%(This is <span class="subst">#&#123;quality&#125;</span> style)</span></span><br><span class="line"><span class="comment"># 应该使用 "This is #&#123;quality&#125; style"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差（多行）</span></span><br><span class="line"><span class="string">%(&lt;div&gt;\n&lt;span class="big"&gt;<span class="subst">#&#123;exclamation&#125;</span>&lt;/span&gt;\n&lt;/div&gt;)</span></span><br><span class="line"><span class="comment"># 应该是一个 heredoc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好（需要插值、有双引号以及单行）</span></span><br><span class="line"><span class="string">%(&lt;tr&gt;&lt;td class="name"&gt;<span class="subst">#&#123;name&#125;</span>&lt;/td&gt;)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>没有 <code>&#39;</code> 和 <code>&quot;</code> 的字符串不要使用 <code>%q</code>。除非需要插值，否则普通字符串可读性更好。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">name = <span class="string">%q(Bruce Wayne)</span></span><br><span class="line">time = <span class="string">%q(8 o'clock)</span></span><br><span class="line">question = <span class="string">%q("What did you say?")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">name = <span class="string">'Bruce Wayne'</span></span><br><span class="line">time = <span class="string">"8 o'clock"</span></span><br><span class="line">question = <span class="string">'"What did you say?"'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>只有正则表达式要匹配多于一个的 <code>/</code> 字元时，使用 <code>%r</code>。</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 差</span><br><span class="line">%r&#123;\s+&#125;</span><br><span class="line"></span><br><span class="line"># 好</span><br><span class="line">%r&#123;^/(.*)$&#125;</span><br><span class="line">%r&#123;^/blog/2011/(.*)$&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>除非调用的命令中用到了反引号（这种情况不常见），否则不要用 <code>%x</code> 。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line">date = <span class="string">%x(date)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line">date = <span class="string">`date`</span></span><br><span class="line">echo = <span class="string">%x(echo `date`)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不要用 <code>%s</code> 。社区倾向使用 <code>:&quot;some string&quot;</code> 来创建含有空白的符号。</p>
</li>
<li><p>用 <code>%</code> 表示字面量时使用 <code>()</code>，<code>%r</code> 除外。因为 <code>(</code> 在正则中比较常用。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="string">%w[one two three]</span></span><br><span class="line"><span class="string">%q&#123;"Test's king!", John said.&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="string">%w(one tho three)</span></span><br><span class="line"><span class="string">%q("Test's king!", John said.)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u5143_u7F16_u7A0B"><a href="#u5143_u7F16_u7A0B" class="headerlink" title="元编程"></a>元编程</h2><ul>
<li><p>避免无谓的元编程。</p>
</li>
<li><p>写一个函数库时不要使核心类混乱（不要使用 monkey patch）。</p>
</li>
<li><p>倾向使用区块形式的 <code>class_eval</code> 而不是字符串插值（string-interpolated）的形式。</p>
<ul>
<li><p>当你使用字符串插值形式时，总是提供 <code>__FILE__</code> 及 <code>__LINE__</code>，使你的 backtrace 看起来有意义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class_eval <span class="string">"def use_relative_model_naming?; true; end"</span>, __FILE_<span class="number">_</span>, __LINE_<span class="number">_</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>倾向使用 <code>define_method</code> 而不是 <code>class_eval{ def ... }</code></p>
</li>
</ul>
</li>
<li><p>当使用 <code>class_eval</code> （或其它的 <code>eval</code>）搭配字符串插值时，添加一个注解区块，来演示如果做了插值的样子（我从 Rails 代码学来的一个实践）：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># activesupport/lib/active_support/core_ext/string/output_safety.rb</span></span><br><span class="line"><span class="constant">UNSAFE_STRING_METHODS</span>.each <span class="keyword">do</span> |unsafe_method|</span><br><span class="line">  <span class="keyword">if</span> <span class="string">'String'</span>.respond_to?(unsafe_method)</span><br><span class="line">    class_eval &lt;&lt;-<span class="constant">EOT</span>, __FILE_<span class="number">_</span>, __LINE_<span class="number">_</span> + <span class="number">1</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="comment">#&#123;unsafe_method&#125;(*args, &amp;block)      # def capitalize(*args, &amp;block)</span></span></span><br><span class="line">        to_str.<span class="comment">#&#123;unsafe_method&#125;(*args, &amp;block) #   to_str.capitalize(*args, &amp;block)</span></span><br><span class="line">      <span class="keyword">end</span>                                      <span class="comment"># end</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="comment">#&#123;unsafe_method&#125;!(*args) # def capitalize!(*args)</span></span></span><br><span class="line">        <span class="variable">@dirty</span> = <span class="keyword">true</span>              <span class="comment">#   <span class="doctag">@dirty</span> = true</span></span><br><span class="line">        <span class="keyword">super</span>                      <span class="comment">#   super</span></span><br><span class="line">      <span class="keyword">end</span>                          <span class="comment"># end</span></span><br><span class="line">    <span class="constant">EOT</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>元编程避免使用 <code>method_missing</code>。它会让 backtraces 变得很凌乱；行为不被罗列在 <code>#methods</code> 里；拼错的方法调用可能默默地工作（<code>nukes.launch_state = false</code>）。考虑使用委托、代理、或是 <code>define_method</code> 来取代。如果你必须使用 <code>method_missing</code>：</p>
<ul>
<li>确保 <a href="http://blog.marc-andre.ca/2010/11/methodmissing-politely.html" target="_blank" rel="external">也定义了 <code>respond_to_missing?</code></a></li>
<li>仅捕捉字首定义良好的方法，像是 <code>find_by_*</code>——让你的代码愈肯定（assertive） 愈好。</li>
<li>在语句的最后调用 <code>super</code></li>
<li><p>委托到确定的、非魔法方法中:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">method_missing?</span><span class="params">(meth, *args, &amp;block)</span></span></span><br><span class="line">  <span class="keyword">if</span> /^find_by<span class="number">_</span>(?&lt;prop&gt;.*)/ =~ meth</span><br><span class="line">    <span class="comment"># ... lots of code to do a find_by</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">super</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">method_missing?</span><span class="params">(meth, *args, &amp;block)</span></span></span><br><span class="line">  <span class="keyword">if</span> /^find_by<span class="number">_</span>(?&lt;prop&gt;.*)/ =~ meth</span><br><span class="line">    find_by(prop, *args, &amp;block)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">super</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最好的方式，可能是每个可找到的属性被声明后，使用 define_method。</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>相比较 <code>send</code>，倾向于使用 <code>public_send</code>，因为 <code>send</code> 会无视 <code>private</code> / <code>protected</code> 的可见性。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We have  an ActiveModel Organization that includes concern Activatable</span></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Activatable</span></span></span><br><span class="line">  extend <span class="constant">ActiveSupport::Concern</span></span><br><span class="line"></span><br><span class="line">  included <span class="keyword">do</span></span><br><span class="line">    before_create <span class="symbol">:create_token</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  private</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">reset_token</span></span></span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create_token</span></span></span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">activate!</span></span></span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Organization</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></span><br><span class="line">  <span class="keyword">include</span> <span class="constant">Activatable</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">linux_organization = <span class="constant">Organization</span>.find(...)</span><br><span class="line"><span class="comment"># BAD - violates privacy</span></span><br><span class="line">linux_organization.send(<span class="symbol">:reset_token</span>)</span><br><span class="line"><span class="comment"># GOOD - should throw an exception</span></span><br><span class="line">linux_organization.public_send(<span class="symbol">:reset_token</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>相比 <code>send</code>，优先使用 <code>__send__</code>，因为调用对象可能已经存在 <code>send</code> 方法。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'socket'</span></span><br><span class="line"></span><br><span class="line">u1 = <span class="constant">UDPSocket</span>.new</span><br><span class="line">u1.bind(<span class="string">'127.0.0.1'</span>, <span class="number">4913</span>)</span><br><span class="line">u2 = <span class="constant">UDPSocket</span>.new</span><br><span class="line">u2.connect(<span class="string">'127.0.0.1'</span>, <span class="number">4913</span>)</span><br><span class="line"><span class="comment"># 不会发送一个消息给接受者</span></span><br><span class="line"><span class="comment"># 实际上通过 UDP socket 发送一个消息</span></span><br><span class="line">u2.send <span class="symbol">:sleep</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送一个消息给接受者，相当于 u2.sleep(0)</span></span><br><span class="line">u2.__send_<span class="number">_</span> <span class="symbol">:sleep</span>, <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="u5176_u5B83"><a href="#u5176_u5B83" class="headerlink" title="其它"></a>其它</h2><ul>
<li><p><code>ruby -w</code> 写安全的代码。</p>
</li>
<li><p>避免使用哈希作为可选参数。这个方法是不是做太多事了？（对象初始器是本规则的例外）。</p>
</li>
<li><p>避免方法长于 10 行代码（LOC）。理想上，大部分的方法会小于 5 行。空行不算进 LOC 里。</p>
</li>
<li><p>避免参数列表长于三或四个参数。</p>
</li>
<li><p>如果你真的需要“全局”方法，把它们加到 Kernel 并设为私有的。</p>
</li>
<li><p>使用模块的实例变量代替全局变量。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 差</span></span><br><span class="line"><span class="variable">$foo_bar</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 好</span></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Foo</span></span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="inheritance">&lt;</span><span class="inheritance">&lt; <span class="parent">self</span></span></span></span><br><span class="line">    <span class="keyword">attr_accessor</span> <span class="symbol">:bar</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Foo</span>.bar = <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>OptionParser</code> 来解析复杂的命令行选项及 <code>ruby -s</code> 来处理琐碎的命令行选项。</p>
</li>
<li><p>使用 <code>Time.now</code> 而不是 <code>Time.new</code> 来获取系统时间。</p>
</li>
<li><p>用函数式的方法编程，在有意义的情况下避免副作用 (mutation)。</p>
</li>
<li><p>不要改变参数，除非那就是方法的目的。</p>
</li>
<li><p>避免超过三层的区块嵌套。</p>
</li>
<li><p>保持一致性。在理想的世界里，遵循这些准则。</p>
</li>
<li><p>使用常识。</p>
</li>
</ul>
<h2 id="u5DE5_u5177"><a href="#u5DE5_u5177" class="headerlink" title="工具"></a>工具</h2><p>以下是一些工具，让你自动检查 Ruby 代码是否符合本指南。</p>
<h3 id="RuboCop"><a href="#RuboCop" class="headerlink" title="RuboCop"></a>RuboCop</h3><p><a href="https://github.com/bbatsov/rubocop" target="_blank" rel="external">RuboCop</a> 是一个基于本指南的 Ruby 代码风格检查工具。 RuboCop 涵盖了本指南相当大的部分，支持 MRI 1.9 和 MRI 2.0，而且与 Emacs 整合良好。</p>
<h3 id="RubyMine"><a href="#RubyMine" class="headerlink" title="RubyMine"></a>RubyMine</h3><p><a href="http://www.jetbrains.com/ruby/" target="_blank" rel="external">RubyMine</a> 的代码检查<a href="http://confluence.jetbrains.com/display/RUBYDEV/RubyMine+Inspections" target="_blank" rel="external">部分基于</a>本指南。</p>
<h1 id="u8D21_u732E"><a href="#u8D21_u732E" class="headerlink" title="贡献"></a>贡献</h1><p>在本指南所写的每条规则都不是定案。这只是我渴望想与同样对 Ruby 编程风格有兴趣的大家一起工作，以致于最终我们可以替整个 Ruby 社区创造一个有益的资源。</p>
<p>欢迎 open tickets 或 push 一个带有改进的更新请求。在此提前感谢你的帮助！</p>
<h2 id="u5982_u4F55_u8D21_u732E_uFF1F"><a href="#u5982_u4F55_u8D21_u732E_uFF1F" class="headerlink" title="如何贡献？"></a>如何贡献？</h2><p>很简单，只需要参考 <a href="https://github.com/bbatsov/ruby-style-guide/blob/master/CONTRIBUTING.md" target="_blank" rel="external">贡献准则</a>。</p>
<h1 id="u6388_u6743"><a href="#u6388_u6743" class="headerlink" title="授权"></a>授权</h1><p><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Creative Commons License"><br>This work is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/deed.zh" target="_blank" rel="external">Creative Commons Attribution 3.0 Unported License</a></p>
<h1 id="u53E3_u8033_u76F8_u4F20"><a href="#u53E3_u8033_u76F8_u4F20" class="headerlink" title="口耳相传"></a>口耳相传</h1><p>一份社区驱动的风格指南，如果没多少人知道，对一个社区来说就没有多少用处。微博转发这份指南，分享给你的朋友或同事。我们得到的每个评价、建议或意见都可以让这份指南变得更好一点。而我们想要拥有的是最好的指南，不是吗？</p>
<p>共勉之，<br><br><a href="https://twitter.com/bbatsov" target="_blank" rel="external">Bozhidar</a></p>

      
      
    </div>
    
  </div>
  
    
<div class="copyright">
  <p><span>本文标题:</span><a href="/2016/01/26/2013-07-02-ruby-style-guide/">Ruby 风格指南</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 萧影随行 的个人博客">萧影随行</a></p>
  <p><span>发布时间:</span>2016年01月26日 - 20时38分</p>
  <p><span>最后更新:</span>2016年01月26日 - 20时38分</p>
  <p>
    <span>原始链接:</span><a href="/2016/01/26/2013-07-02-ruby-style-guide/" title="Ruby 风格指南">http://notes.seirhsiao.com/2016/01/26/2013-07-02-ruby-style-guide/</a>
    <span class="btn" data-clipboard-text="原文: http://notes.seirhsiao.com/2016/01/26/2013-07-02-ruby-style-guide/　　作者: 萧影随行" title="点击复制文章链接">
        <i class="fa fa-clipboard"></i>
    </span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p>
  <script src="/js/clipboard.min.js"></script>
  <script> var clipboard = new Clipboard('.btn'); </script>
</div>
<style type="text/css">
  .copyright p .btn {
    margin-left: 1em;
  }
  .copyright:hover p .btn::after {
    content: "复制"
  }
  .copyright p .btn:hover {
      color: gray;
      cursor: pointer;
    };
</style>



<nav id="article-nav">
  
    <div id="article-nav-newer" class="article-nav-title">
      <a href="/2016/01/26/2013-07-01-git-style-guide/">
        Git 风格指南
      </a>
    </div>
  
  
    <div id="article-nav-older" class="article-nav-title">
      <a href="/2016/01/26/2013-07-03-rails-style-guide/">
        Rails 风格指南
      </a>
    </div>
  
</nav>

  
</article>

<!-- 默认显示文章目录，在文章---前输入toc: false关闭目录 -->
<!-- Show TOC and tocButton in default, Hide TOC via putting "toc: false" before "---" at [post].md -->
<div id="toc" class="toc-article">
<strong class="toc-title">文章目录</strong>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#u5E8F_u5E55"><span class="toc-number">1.</span> <span class="toc-text">序幕</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ruby__u98CE_u683C_u6307_u5357"><span class="toc-number">2.</span> <span class="toc-text">Ruby 风格指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u76EE_u5F55"><span class="toc-number">2.1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6E90_u4EE3_u7801_u6392_u7248"><span class="toc-number">2.2.</span> <span class="toc-text">源代码排版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u8BED_u6CD5"><span class="toc-number">2.3.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u547D_u540D"><span class="toc-number">2.4.</span> <span class="toc-text">命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6CE8_u91CA"><span class="toc-number">2.5.</span> <span class="toc-text">注释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u6CE8_u89E3"><span class="toc-number">2.5.1.</span> <span class="toc-text">注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7C7B_u4E0E_u6A21_u5757"><span class="toc-number">2.6.</span> <span class="toc-text">类与模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5F02_u5E38"><span class="toc-number">2.7.</span> <span class="toc-text">异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u96C6_u5408"><span class="toc-number">2.8.</span> <span class="toc-text">集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5B57_u7B26_u4E32"><span class="toc-number">2.9.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6B63_u5219_u8868_u8FBE_u5F0F"><span class="toc-number">2.10.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u767E_u5206_u53F7_u5B57_u9762_u91CF"><span class="toc-number">2.11.</span> <span class="toc-text">百分号字面量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5143_u7F16_u7A0B"><span class="toc-number">2.12.</span> <span class="toc-text">元编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5176_u5B83"><span class="toc-number">2.13.</span> <span class="toc-text">其它</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5DE5_u5177"><span class="toc-number">2.14.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RuboCop"><span class="toc-number">2.14.1.</span> <span class="toc-text">RuboCop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RubyMine"><span class="toc-number">2.14.2.</span> <span class="toc-text">RubyMine</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u8D21_u732E"><span class="toc-number">3.</span> <span class="toc-text">贡献</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u5982_u4F55_u8D21_u732E_uFF1F"><span class="toc-number">3.1.</span> <span class="toc-text">如何贡献？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u6388_u6743"><span class="toc-number">4.</span> <span class="toc-text">授权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u53E3_u8033_u76F8_u4F20"><span class="toc-number">5.</span> <span class="toc-text">口耳相传</span></a></li></ol>
</div>
<style type="text/css">
  .left-col .switch-btn {
    display: none;
  }
  .left-col .switch-area {
    display: none;
  }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script type="text/javascript">
  var toc_button= document.getElementById("tocButton");
  var toc_div= document.getElementById("toc");
  /* Show or hide toc when click on tocButton.
  通过点击设置的按钮显示或者隐藏文章目录.*/
  toc_button.onclick=function(){
  if(toc_div.style.display=="none"){
  toc_div.style.display="block";
  toc_button.value="隐藏目录";
  document.getElementById("switch-btn").style.display="none";
  document.getElementById("switch-area").style.display="none";
  }
  else{
  toc_div.style.display="none";
  toc_button.value="显示目录";
  document.getElementById("switch-btn").style.display="block";
  document.getElementById("switch-area").style.display="block";
  }
  }
</script>


<div class="share">
	<div class="bdsharebuttonbox">
	<a href="#" class="bds_more" data-cmd="more"></a>
	<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
	<a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
	<a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
	<a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
	</div>
	<script>
	window._bd_share_config={
		"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	</script>
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/01/26/2013-07-02-ruby-style-guide/" data-title="Ruby 风格指南" data-url="http://notes.seirhsiao.com/2016/01/26/2013-07-02-ruby-style-guide/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"hsiao-tech"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>






    <style type="text/css">
    #scroll {
      display: none;
    }
    </style>
    <div class="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#ds-thread" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
    </div>


  
  
    
    <div  class="post-nav-button">
    <a href="/2016/01/26/2013-07-01-git-style-guide/" title="上一篇: Git 风格指南">
    <i class="fa fa-angle-left"></i>
    </a>
    <a href="/2016/01/26/2013-07-03-rails-style-guide/" title="下一篇: Rails 风格指南">
    <i class="fa fa-angle-right"></i>
    </a>
    </div>
  



    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2016 萧影随行
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/seirhsiao/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by 萧
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>